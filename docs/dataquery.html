<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>dataquery API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#upload_files">upload_files</a>
            </li>
            <li>
                    <a class="function" href="#remove_view">remove_view</a>
            </li>
            <li>
                    <a class="function" href="#files_to_db">files_to_db</a>
            </li>
            <li>
                    <a class="function" href="#get_file_options">get_file_options</a>
            </li>
            <li>
                    <a class="function" href="#files_to_table">files_to_table</a>
            </li>
            <li>
                    <a class="function" href="#register_dataframe">register_dataframe</a>
            </li>
            <li>
                    <a class="function" href="#clean_table_name">clean_table_name</a>
            </li>
            <li>
                    <a class="function" href="#get_preview_data">get_preview_data</a>
            </li>
            <li>
                    <a class="function" href="#data_preview">data_preview</a>
            </li>
            <li>
                    <a class="function" href="#get_query">get_query</a>
            </li>
            <li>
                    <a class="function" href="#run_query">run_query</a>
            </li>
            <li>
                    <a class="function" href="#query_result">query_result</a>
            </li>
            <li>
                    <a class="function" href="#data_download">data_download</a>
            </li>
            <li>
                    <a class="function" href="#df_to_file">df_to_file</a>
            </li>
            <li>
                    <a class="function" href="#sql_completions">sql_completions</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
dataquery    </h1>

                
                        <input id="mod-dataquery-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-dataquery-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">duckdb</span> 
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="kn">import</span> <span class="n">sub</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">os.path</span><span class="w"> </span><span class="kn">import</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">basename</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandavro</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pdx</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>  
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">code_editor</span><span class="w"> </span><span class="kn">import</span> <span class="n">code_editor</span>  
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">def</span><span class="w"> </span><span class="nf">upload_files</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    Uploads data files and zip archives.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    Args:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">        file_ext (list): A list of file extensions to filter the uploaded files.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    Returns:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">        list: A list of uploaded files stored in `st.session_state.uploaded_files`.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Notes:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        - Handles file uploads via Streamlit&#39;s file uploader.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        - Removes views from the database for files that are no longer uploaded.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="c1"># Upload files object</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="n">uploaded_files</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="s2">&quot;Choose data files&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="n">accept_multiple_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Upload your data files and zip archives.  </span><span class="se">\n</span><span class="s1">All files from zip archives and all sheets of xlsx files will be considered.&#39;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">file_ext</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="c1"># Check for removed files</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="n">removed_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uploaded_files</span><span class="p">]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="c1"># Remove views from the database for removed files</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">removed_files</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="n">tables_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables_to_remove</span><span class="p">:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>            <span class="n">remove_view</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed file: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and its associated tables&quot;</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="c1"># Update the list of uploaded files</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="n">uploaded_files</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_view</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">view_name</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    Safely removes a view from the DuckDB connection.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    Args:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        con (duckdb.Connection): The DuckDB connection object.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        view_name (str): The name of the view to remove.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    Returns:</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        None</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    Notes:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">        - If the view does not exist or cannot be dropped, a warning is displayed.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DROP VIEW IF EXISTS &quot;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">except</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">CatalogException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not drop view </span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="k">def</span><span class="w"> </span><span class="nf">files_to_db</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    Loads files into a DuckDB database and registers them as tables.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    Args:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">        file_ext (list): A list of file extensions to be loaded.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">    Returns:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        dict: A dictionary mapping table names to file names.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">    Notes:</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        - Logs messages about successfully loaded tables and excluded files.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        - Handles zip archives and extracts supported files for loading.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        - Registers tables in the DuckDB connection.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="n">loaded_tab</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="n">excluded_tab</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="n">file_options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span><span class="p">:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">file</span><span class="p">]:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="c1"># Manage zip archives</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;application/x-zip-compressed&quot;</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                    <span class="k">for</span> <span class="n">zip_info</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">infolist</span><span class="p">():</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">zip_info</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                            <span class="n">_</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                            <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">file_ext</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                                <span class="k">with</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">zip_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                                    <span class="n">extracted_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                                    <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                                    <span class="c1"># Get file options</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                                    <span class="n">options</span> <span class="o">=</span> <span class="n">get_file_options</span><span class="p">(</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                                        <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                                        <span class="kc">None</span> <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;xlsx&#39;</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">extracted_file</span><span class="p">)</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                                        <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                                    <span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                                    <span class="n">file_options</span><span class="p">[</span><span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>                                    <span class="c1"># Load tables and register views in DuckDB</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                                    <span class="n">loaded_tables</span> <span class="o">=</span> <span class="n">files_to_table</span><span class="p">(</span><span class="n">extracted_file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                                    <span class="k">if</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>                                        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                                            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                                        <span class="n">loaded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as table(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loaded_tables</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                                <span class="n">excluded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> not loaded. Unsupported file format  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>            <span class="c1"># Manage single files</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                <span class="c1"># Get file options</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">options</span> <span class="o">=</span> <span class="n">get_file_options</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;xlsx&#39;</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                <span class="c1"># Load tables and register views in DuckDB</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">file_options</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>                <span class="n">loaded_tables</span> <span class="o">=</span> <span class="n">files_to_table</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>                <span class="k">if</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                    <span class="n">loaded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as table(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loaded_tables</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="c1"># Display success and warning messages</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">if</span> <span class="n">loaded_tab</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">loaded_tab</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="k">if</span> <span class="n">excluded_tab</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">excluded_tab</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_file_options</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    Generates file options for CSV, TXT, and XLSX files based on user input.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    Args:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        file_name (str): The name of the file.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        sheet_names (list, optional): A list of sheet names for Excel files. Defaults to None.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        archive_name (str, optional): The name of the zip archive. Defaults to None.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    Returns:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        dict: A dictionary containing the selected options for the file or its sheets.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">    Notes:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        - Displays Streamlit UI components for user input.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        - Supports options like headers, delimiters, and quoting for CSV/TXT files.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">label_obj</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">archive_name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">]:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File Settings - </span><span class="si">{</span><span class="n">label_obj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="n">left_column</span><span class="p">,</span> <span class="n">right_column</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                <span class="n">options</span><span class="p">[</span><span class="s1">&#39;sheets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sheet_names</span><span class="p">):</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                    <span class="k">with</span> <span class="n">left_column</span> <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">right_column</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;sheets&#39;</span><span class="p">][</span><span class="n">sheet</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                            <span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>                                <span class="sa">f</span><span class="s2">&quot;Header for </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">sheet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                                <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                                <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;header_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sheet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                            <span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                        <span class="p">}</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>                <span class="n">left_column</span><span class="p">,</span> <span class="n">right_column</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>                <span class="k">with</span> <span class="n">left_column</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>                        <span class="sa">f</span><span class="s2">&quot;Header&quot;</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>                        <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>                        <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;header_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>                    <span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;delimiter_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="k">with</span> <span class="n">right_column</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                    <span class="n">quoting_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                        <span class="s1">&#39;QUOTE_ALL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_ALL</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                        <span class="s1">&#39;QUOTE_MINIMAL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>                        <span class="s1">&#39;QUOTE_NONNUMERIC&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>                        <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>                    <span class="p">}</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;quoting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>                        <span class="sa">f</span><span class="s2">&quot;Quoting&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">quoting_options</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;quoting_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                    <span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;quotechar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quote character&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;quote_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;str&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>    <span class="k">return</span> <span class="n">options</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="k">def</span><span class="w"> </span><span class="nf">files_to_table</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">    Get dataframe from file and register it in a database connection.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    Args:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        file: File object or path to the file.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        con: Database connection object.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        options: Dict of options for file loading.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        archive_name: Name of the zip archive.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">    Returns:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        table_names(List): List of table names where the data was registered, or None if there was an error.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>    <span class="c1"># Get file extension, file name, and archive name</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>    <span class="n">file_nm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archive_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">archive_name</span> <span class="k">else</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    <span class="n">table_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="c1"># Manage CSV and TXT using collected file settings</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">delim</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span> <span class="k">else</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="c1"># Read CSV using utf-8 encoding</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                <span class="n">file</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>                <span class="n">sep</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                <span class="n">quoting</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">csv</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quoting&#39;</span><span class="p">,</span> <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">)),</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="n">quotechar</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quotechar&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">),</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                <span class="n">header</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="n">on_bad_lines</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="n">encoding_errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="c1"># In case of no header, rename columns from simple integer to col_integer</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="c1"># Manage XLSX using header settings collected</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="n">xls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="c1"># Loop all sheets and in case of no header, rename columns from simple integer to col_integer</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="k">for</span> <span class="n">sheet_name</span> <span class="ow">in</span> <span class="n">xls</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                <span class="n">sheet_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sheets&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                <span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">sheet_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                <span class="k">if</span> <span class="n">sheet_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>                    <span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="c1"># Manage other accepted file formats</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;avro&#39;</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pdx</span><span class="o">.</span><span class="n">read_avro</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">na_dtypes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="c1"># It&#39;s a single object</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">json_data</span><span class="p">])</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="c1"># It&#39;s a list of objects</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not loaded. Unsupported file format.&quot;</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="c1"># Register dataframes into DuckDB</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="k">for</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sheet_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                <span class="n">table_name</span> <span class="o">=</span> <span class="n">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_nm</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sheet_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>                <span class="n">table_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="n">table_name</span> <span class="o">=</span> <span class="n">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_nm</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">table_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="n">table_names</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="c1"># Manage exception of wrong file settings provided for CSV and TXT</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;Error tokenizing data&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> not loaded. Please check file settings.&#39;</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="k">def</span><span class="w"> </span><span class="nf">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    Register a DataFrame in the connection object.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    Args:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        con (Connection): The connection object to register the DataFrame.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        df (pd.DataFrame): The DataFrame to register.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        file_name (str): The name of the file (used to generate the table name).</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    Returns:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        table_name(str): The name of the registered table.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="c1"># Clean table name</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="n">table_name</span> <span class="o">=</span> <span class="n">clean_table_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="c1"># Register view in db</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>    <span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="k">return</span> <span class="n">table_name</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="k">def</span><span class="w"> </span><span class="nf">clean_table_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">    Cleans the table name by replacing spaces with underscores and removing all other special characters.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">    Adds an underscore if the name starts or ends with a number.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    Args:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        name (str): The table name to be cleaned.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">    Returns:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        name(str): The cleaned table name.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="c1"># Replace spaces with underscores</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="c1"># Remove all other special characters</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9_]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="c1"># Add an underscore if the name starts with a number</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>    <span class="c1"># Add an underscore if the name ends with a number</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="k">return</span> <span class="n">name</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_preview_data</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">    Get preview data for a given table.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">    Args:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">        con (Connection): The DuckDB connection object.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">        table_name (str): The name of the table to preview.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">        num_rows (int): The number of rows to preview.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">    Returns:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        df(pandas.DataFrame): A DataFrame containing the preview data.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="c1"># Get first 5 rows of the table</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;SELECT * FROM &quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot; LIMIT </span><span class="si">{</span><span class="n">num_rows</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="c1"># Reset index to start from 1</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="k">return</span> <span class="n">df</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="k">def</span><span class="w"> </span><span class="nf">data_preview</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">    Display data preview for each table.</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    Args:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        num_rows (int): The number of rows to preview.</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">    Returns:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        st.dataframe(preview_df): The preview of the selected table.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Data Preview&quot;</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">tab_prev</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Select Table:&#39;</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="n">preview_df</span> <span class="o">=</span> <span class="n">get_preview_data</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">tab_prev</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">preview_df</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_query</span><span class="p">():</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">    Function to get user input for SQL query and execute it, with table/column suggestions.</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">    Returns:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        st.session_state.query_result(pd.DataFrame): The result of the executed query, or None if no query was entered.</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Query Data&quot;</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">caption</span><span class="p">(</span><span class="s2">&quot;Type your SQL query below and press </span><span class="se">\&quot;</span><span class="s2">Ctrl + Enter</span><span class="se">\&quot;</span><span class="s2"> to run it.&quot;</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="c1"># Define SQL completions based on loaded tables and columns</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">sql_completions</span><span class="p">()</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="c1"># Define action to submit written query. Ctrl + Enter or mouse click</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="n">query_btn</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Run&quot;</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="s2">&quot;feather&quot;</span><span class="p">:</span> <span class="s2">&quot;Play&quot;</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="s2">&quot;primary&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="s2">&quot;hasText&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="s2">&quot;showWithIcon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="s2">&quot;commands&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;saveState&quot;</span><span class="p">,</span><span class="s2">&quot;submit&quot;</span><span class="p">],</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="s2">&quot;0.44rem&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4rem&quot;</span><span class="p">},</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="s2">&quot;alwaysOn&quot;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>    <span class="p">}]</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>    <span class="c1"># Define code editor options</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="n">sql_query_input</span> <span class="o">=</span> <span class="n">code_editor</span><span class="p">(</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">,</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;enableBasicAutocompletion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;enableLiveAutocompletion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="n">completions</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">buttons</span><span class="o">=</span><span class="n">query_btn</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">shortcuts</span><span class="o">=</span><span class="s2">&quot;vscode&quot;</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">focus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">props</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;highlightActiveLine&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;sql_query_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="n">allow_reset</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="c1"># Get SQL query from code editor once sumitted</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>    <span class="k">if</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="ow">and</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="c1"># Button to run query</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="c1">#if st.button(&quot;Run Query&quot;):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="c1"># Run query</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">run_query</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="c1"># Reset index to start from 1 for query results</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">result_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="n">result_df</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&quot;Query executed successfully!&quot;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="c1"># Catch exception of wrong table name and update command</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="k">if</span> <span class="s2">&quot;Catalog Error: Table with name&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table not existing. Please check table names in your query.&quot;</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="k">elif</span> <span class="s2">&quot;Can only update base table&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Update not available. Please consider a different select statement and the edit mode.&quot;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="c1">#:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>    <span class="c1">#    st.warning(&quot;Please enter a SQL query.&quot;)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="k">def</span><span class="w"> </span><span class="nf">run_query</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql_query</span><span class="p">):</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">    Executes the given SQL query on the provided connection object and returns the result.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    Args:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">        con (connection): The connection object to the database.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        sql_query (str): The SQL query to be executed.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">    Returns:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        result(pd.DataFrame): The result of the SQL query as a DataFrame.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="c1"># Execute SQL query</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="k">def</span><span class="w"> </span><span class="nf">query_result</span><span class="p">():</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    Displays the query result and allows for editing and exporting of data.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">    Returns:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        st.session_state.query_result, st.session_state.export_df(Tuple): A tuple containing the query result dataframe and the export dataframe.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Query Result&quot;</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="c1"># Add a toggle for edit mode</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    <span class="n">edit_mode</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">toggle</span><span class="p">(</span><span class="s2">&quot;Edit Mode&quot;</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="c1"># Manage the edit mode</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>    <span class="k">if</span> <span class="n">edit_mode</span><span class="p">:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">data_editor</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="c1"># Prepare dataframe for export data</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="k">def</span><span class="w"> </span><span class="nf">data_download</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">    Function to download data in different file formats.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">    Parameters:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        file_ext (List[str]): List of file extensions available for download.</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">    Returns:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        st.download_button: Download button component that allows the user to download the selected file format.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">popover</span><span class="p">(</span><span class="s2">&quot;Data Download&quot;</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="c1"># File format selection</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="n">file_formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_ext</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s1">&#39;zip&#39;</span><span class="p">]</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>            <span class="n">selected_format</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Select file format:&quot;</span><span class="p">,</span> <span class="n">file_formats</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>            <span class="c1"># Delimiter and quoting options (for CSV)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">if</span> <span class="n">selected_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                <span class="n">header</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Header:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>                <span class="n">delimiter</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Delimiter:&quot;</span><span class="p">,</span> <span class="n">max_chars</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>                <span class="n">quoting_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                    <span class="s1">&#39;QUOTE_ALL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_ALL</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                    <span class="s1">&#39;QUOTE_MINIMAL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>                    <span class="s1">&#39;QUOTE_NONNUMERIC&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>                    <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>                <span class="p">}</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>                <span class="n">quoting</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Quoting:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">quoting_options</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>                <span class="n">head</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">,</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                    <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">quoting_options</span><span class="p">[</span><span class="n">quoting</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">head</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>            <span class="c1"># Manage XLSX download</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="k">elif</span> <span class="n">selected_format</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="n">header</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Header:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                <span class="n">head</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">head</span><span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="c1"># Manage other file download</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="c1"># Generate file name and MIME type</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;query_result.</span><span class="si">{</span><span class="n">selected_format</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="n">mime_types</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>                <span class="s1">&#39;csv&#39;</span><span class="p">:</span> <span class="s1">&#39;text/csv&#39;</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>                <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span> <span class="s1">&#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>                <span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>                <span class="s1">&#39;parquet&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>                <span class="s1">&#39;xml&#39;</span><span class="p">:</span> <span class="s1">&#39;application/xml&#39;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="p">}</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="n">mime_type</span> <span class="o">=</span> <span class="n">mime_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selected_format</span><span class="p">,</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>            <span class="c1"># Download button</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Download&quot;</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>                <span class="n">data</span><span class="o">=</span><span class="n">file_content</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="n">mime</span><span class="o">=</span><span class="n">mime_type</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="k">def</span><span class="w"> </span><span class="nf">df_to_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">    Convert DataFrame to various file formats.</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">    Args:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        df (pd.DataFrame): The DataFrame to convert.</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">        file_format (str): The desired file format.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a><span class="sd">        **kwargs: Additional arguments for specific file formats.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a><span class="sd">    Returns:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a><span class="sd">        bytes: The DataFrame converted to the specified format.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="c1"># Create the buffer</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="c1"># Manage CSV and TXT files</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="k">if</span> <span class="n">file_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>            <span class="c1"># Catch specific CSV writing errors</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="k">except</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>                <span class="k">if</span> <span class="s2">&quot;need to escape&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Special character found in the data.  </span><span class="se">\n</span><span class="s2">Please select a different quoting option.&quot;</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> writing error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="c1"># Manage XLSX files</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="c1"># Manage JSON files</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="c1"># Manage Parquet files</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pyarrow&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="c1"># Manage XML files</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="c1"># Manage Avro files</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;avro&#39;</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>            <span class="n">pdx</span><span class="o">.</span><span class="n">to_avro</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>        <span class="c1"># Get unsupported files error</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>    <span class="c1"># Catch errors for df to file conversion</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> export not available for your data.  </span><span class="se">\n</span><span class="s2">Please select a different format.&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>    <span class="c1"># Return the buffer</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>    <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>    <span class="k">return</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="k">def</span><span class="w"> </span><span class="nf">sql_completions</span><span class="p">():</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">    Function to generate SQL completions for the code editor.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">    Returns:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">        None</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="c1"># Get connection</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>        <span class="n">con</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="c1"># Get loaded tables list</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="n">tab_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="c1"># Reset completions list</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="c1"># Loop all tables and get columns names</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tab_list</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>            <span class="c1"># Ensure table_name is a non-empty string before proceeding</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">table_name</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                <span class="c1"># Add table name completion</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>  <span class="c1"># Add quotes for safety</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;table_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Added unique name</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mi">200</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                <span class="p">})</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>                <span class="c1"># Get column names for the table</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                    <span class="c1"># Use PRAGMA table_info to fetch column metadata</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>                    <span class="n">columns_df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PRAGMA table_info(&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">columns_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                        <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">columns_df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                            <span class="c1"># Ensure column_name is a non-empty string</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">column_name</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                                <span class="c1"># Add column name completion</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>  <span class="c1"># Add quotes for safety</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>                                    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="s2">&quot;column&quot;</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;col_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Added unique name</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mi">100</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                                <span class="p">})</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fetch columns for table &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                    <span class="k">pass</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not generate SQL suggestions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="k">pass</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">    The main function of the DataQuery application.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">    This function handles the main logic of the application, including file uploading, data loading, data preview, SQL query execution, and result visualization.</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">    It collects files settings for csv, txt and xlsx files.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">    It also provides options for editing and downloading query results.</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">    Returns:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a><span class="sd">        None</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>    <span class="c1"># Set page config</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">set_page_config</span><span class="p">(</span><span class="n">page_title</span><span class="o">=</span><span class="s1">&#39;DataQuery&#39;</span><span class="p">,</span> <span class="n">page_icon</span><span class="o">=</span><span class="s1">&#39;:o:&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;wide&quot;</span><span class="p">)</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>    <span class="c1"># Set title and subheader</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DataQuery&quot;</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Preview, query, edit and export data files&quot;</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>    <span class="c1"># Supported file extensions</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>    <span class="n">file_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avro&#39;</span><span class="p">,</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;parquet&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">]</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>    <span class="c1"># Number of rows read for preview</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>    <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>    <span class="c1"># Initialize session state variables</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>    <span class="k">if</span> <span class="s1">&#39;query_result&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>    <span class="k">if</span> <span class="s1">&#39;tables&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>    <span class="k">if</span> <span class="s1">&#39;con&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>    <span class="k">if</span> <span class="s1">&#39;uploaded_files&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>    <span class="k">if</span> <span class="s1">&#39;edited_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>    <span class="k">if</span> <span class="s1">&#39;export_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>    <span class="k">if</span> <span class="s1">&#39;completions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>    <span class="k">if</span> <span class="s1">&#39;query_statement&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>    <span class="c1"># Files upload</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>    <span class="n">upload_files</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>    <span class="c1"># If files uploaded</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>        <span class="c1"># Load files to db</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>        <span class="n">files_to_db</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        <span class="c1"># If tables created</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>            <span class="c1"># Display data preview for each table</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>            <span class="n">data_preview</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>            <span class="c1"># Provide SQL query section</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>            <span class="n">get_query</span><span class="p">()</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>        <span class="c1"># If query result</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            <span class="c1"># Display query result</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>            <span class="n">query_result</span><span class="p">()</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>            <span class="c1"># Display data download section</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="n">data_download</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>        <span class="c1"># Reset session state variables</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="upload_files">
                            <input id="upload_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">upload_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_ext</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="upload_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#upload_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="upload_files-15"><a href="#upload_files-15"><span class="linenos">15</span></a><span class="k">def</span><span class="w"> </span><span class="nf">upload_files</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="upload_files-16"><a href="#upload_files-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="upload_files-17"><a href="#upload_files-17"><span class="linenos">17</span></a><span class="sd">    Uploads data files and zip archives.</span>
</span><span id="upload_files-18"><a href="#upload_files-18"><span class="linenos">18</span></a>
</span><span id="upload_files-19"><a href="#upload_files-19"><span class="linenos">19</span></a><span class="sd">    Args:</span>
</span><span id="upload_files-20"><a href="#upload_files-20"><span class="linenos">20</span></a><span class="sd">        file_ext (list): A list of file extensions to filter the uploaded files.</span>
</span><span id="upload_files-21"><a href="#upload_files-21"><span class="linenos">21</span></a>
</span><span id="upload_files-22"><a href="#upload_files-22"><span class="linenos">22</span></a><span class="sd">    Returns:</span>
</span><span id="upload_files-23"><a href="#upload_files-23"><span class="linenos">23</span></a><span class="sd">        list: A list of uploaded files stored in `st.session_state.uploaded_files`.</span>
</span><span id="upload_files-24"><a href="#upload_files-24"><span class="linenos">24</span></a>
</span><span id="upload_files-25"><a href="#upload_files-25"><span class="linenos">25</span></a><span class="sd">    Notes:</span>
</span><span id="upload_files-26"><a href="#upload_files-26"><span class="linenos">26</span></a><span class="sd">        - Handles file uploads via Streamlit&#39;s file uploader.</span>
</span><span id="upload_files-27"><a href="#upload_files-27"><span class="linenos">27</span></a><span class="sd">        - Removes views from the database for files that are no longer uploaded.</span>
</span><span id="upload_files-28"><a href="#upload_files-28"><span class="linenos">28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="upload_files-29"><a href="#upload_files-29"><span class="linenos">29</span></a>    <span class="c1"># Upload files object</span>
</span><span id="upload_files-30"><a href="#upload_files-30"><span class="linenos">30</span></a>    <span class="n">uploaded_files</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">file_uploader</span><span class="p">(</span>
</span><span id="upload_files-31"><a href="#upload_files-31"><span class="linenos">31</span></a>        <span class="s2">&quot;Choose data files&quot;</span><span class="p">,</span>
</span><span id="upload_files-32"><a href="#upload_files-32"><span class="linenos">32</span></a>        <span class="n">accept_multiple_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="upload_files-33"><a href="#upload_files-33"><span class="linenos">33</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Upload your data files and zip archives.  </span><span class="se">\n</span><span class="s1">All files from zip archives and all sheets of xlsx files will be considered.&#39;</span><span class="p">,</span>
</span><span id="upload_files-34"><a href="#upload_files-34"><span class="linenos">34</span></a>        <span class="nb">type</span><span class="o">=</span><span class="n">file_ext</span><span class="p">,</span>
</span><span id="upload_files-35"><a href="#upload_files-35"><span class="linenos">35</span></a>    <span class="p">)</span>
</span><span id="upload_files-36"><a href="#upload_files-36"><span class="linenos">36</span></a>
</span><span id="upload_files-37"><a href="#upload_files-37"><span class="linenos">37</span></a>    <span class="c1"># Check for removed files</span>
</span><span id="upload_files-38"><a href="#upload_files-38"><span class="linenos">38</span></a>    <span class="n">removed_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uploaded_files</span><span class="p">]</span>
</span><span id="upload_files-39"><a href="#upload_files-39"><span class="linenos">39</span></a>    <span class="c1"># Remove views from the database for removed files</span>
</span><span id="upload_files-40"><a href="#upload_files-40"><span class="linenos">40</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">removed_files</span><span class="p">:</span>
</span><span id="upload_files-41"><a href="#upload_files-41"><span class="linenos">41</span></a>        <span class="n">tables_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="upload_files-42"><a href="#upload_files-42"><span class="linenos">42</span></a>        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables_to_remove</span><span class="p">:</span>
</span><span id="upload_files-43"><a href="#upload_files-43"><span class="linenos">43</span></a>            <span class="n">remove_view</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">table</span><span class="p">)</span>
</span><span id="upload_files-44"><a href="#upload_files-44"><span class="linenos">44</span></a>            <span class="k">del</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
</span><span id="upload_files-45"><a href="#upload_files-45"><span class="linenos">45</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed file: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and its associated tables&quot;</span><span class="p">)</span>
</span><span id="upload_files-46"><a href="#upload_files-46"><span class="linenos">46</span></a>
</span><span id="upload_files-47"><a href="#upload_files-47"><span class="linenos">47</span></a>    <span class="c1"># Update the list of uploaded files</span>
</span><span id="upload_files-48"><a href="#upload_files-48"><span class="linenos">48</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="n">uploaded_files</span>
</span><span id="upload_files-49"><a href="#upload_files-49"><span class="linenos">49</span></a>
</span><span id="upload_files-50"><a href="#upload_files-50"><span class="linenos">50</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span>
</span></pre></div>


            <div class="docstring"><p>Uploads data files and zip archives.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>file_ext (list):</strong>  A list of file extensions to filter the uploaded files.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list: A list of uploaded files stored in <code>st.session_state.uploaded_files</code>.</p>
</blockquote>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>Handles file uploads via Streamlit's file uploader.</li>
  <li>Removes views from the database for files that are no longer uploaded.</li>
  </ul>
</blockquote>
</div>


                </section>
                <section id="remove_view">
                            <input id="remove_view-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_view</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">con</span>, </span><span class="param"><span class="n">view_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="remove_view-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#remove_view"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="remove_view-53"><a href="#remove_view-53"><span class="linenos">53</span></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_view</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">view_name</span><span class="p">):</span>
</span><span id="remove_view-54"><a href="#remove_view-54"><span class="linenos">54</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="remove_view-55"><a href="#remove_view-55"><span class="linenos">55</span></a><span class="sd">    Safely removes a view from the DuckDB connection.</span>
</span><span id="remove_view-56"><a href="#remove_view-56"><span class="linenos">56</span></a>
</span><span id="remove_view-57"><a href="#remove_view-57"><span class="linenos">57</span></a><span class="sd">    Args:</span>
</span><span id="remove_view-58"><a href="#remove_view-58"><span class="linenos">58</span></a><span class="sd">        con (duckdb.Connection): The DuckDB connection object.</span>
</span><span id="remove_view-59"><a href="#remove_view-59"><span class="linenos">59</span></a><span class="sd">        view_name (str): The name of the view to remove.</span>
</span><span id="remove_view-60"><a href="#remove_view-60"><span class="linenos">60</span></a>
</span><span id="remove_view-61"><a href="#remove_view-61"><span class="linenos">61</span></a><span class="sd">    Returns:</span>
</span><span id="remove_view-62"><a href="#remove_view-62"><span class="linenos">62</span></a><span class="sd">        None</span>
</span><span id="remove_view-63"><a href="#remove_view-63"><span class="linenos">63</span></a>
</span><span id="remove_view-64"><a href="#remove_view-64"><span class="linenos">64</span></a><span class="sd">    Notes:</span>
</span><span id="remove_view-65"><a href="#remove_view-65"><span class="linenos">65</span></a><span class="sd">        - If the view does not exist or cannot be dropped, a warning is displayed.</span>
</span><span id="remove_view-66"><a href="#remove_view-66"><span class="linenos">66</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="remove_view-67"><a href="#remove_view-67"><span class="linenos">67</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="remove_view-68"><a href="#remove_view-68"><span class="linenos">68</span></a>        <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DROP VIEW IF EXISTS &quot;</span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
</span><span id="remove_view-69"><a href="#remove_view-69"><span class="linenos">69</span></a>    <span class="k">except</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">CatalogException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="remove_view-70"><a href="#remove_view-70"><span class="linenos">70</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not drop view </span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Safely removes a view from the DuckDB connection.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>con (duckdb.Connection):</strong>  The DuckDB connection object.</li>
<li><strong>view_name (str):</strong>  The name of the view to remove.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>If the view does not exist or cannot be dropped, a warning is displayed.</li>
  </ul>
</blockquote>
</div>


                </section>
                <section id="files_to_db">
                            <input id="files_to_db-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">files_to_db</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_ext</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="files_to_db-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#files_to_db"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="files_to_db-73"><a href="#files_to_db-73"><span class="linenos"> 73</span></a><span class="k">def</span><span class="w"> </span><span class="nf">files_to_db</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="files_to_db-74"><a href="#files_to_db-74"><span class="linenos"> 74</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="files_to_db-75"><a href="#files_to_db-75"><span class="linenos"> 75</span></a><span class="sd">    Loads files into a DuckDB database and registers them as tables.</span>
</span><span id="files_to_db-76"><a href="#files_to_db-76"><span class="linenos"> 76</span></a>
</span><span id="files_to_db-77"><a href="#files_to_db-77"><span class="linenos"> 77</span></a><span class="sd">    Args:</span>
</span><span id="files_to_db-78"><a href="#files_to_db-78"><span class="linenos"> 78</span></a><span class="sd">        file_ext (list): A list of file extensions to be loaded.</span>
</span><span id="files_to_db-79"><a href="#files_to_db-79"><span class="linenos"> 79</span></a>
</span><span id="files_to_db-80"><a href="#files_to_db-80"><span class="linenos"> 80</span></a><span class="sd">    Returns:</span>
</span><span id="files_to_db-81"><a href="#files_to_db-81"><span class="linenos"> 81</span></a><span class="sd">        dict: A dictionary mapping table names to file names.</span>
</span><span id="files_to_db-82"><a href="#files_to_db-82"><span class="linenos"> 82</span></a>
</span><span id="files_to_db-83"><a href="#files_to_db-83"><span class="linenos"> 83</span></a><span class="sd">    Notes:</span>
</span><span id="files_to_db-84"><a href="#files_to_db-84"><span class="linenos"> 84</span></a><span class="sd">        - Logs messages about successfully loaded tables and excluded files.</span>
</span><span id="files_to_db-85"><a href="#files_to_db-85"><span class="linenos"> 85</span></a><span class="sd">        - Handles zip archives and extracts supported files for loading.</span>
</span><span id="files_to_db-86"><a href="#files_to_db-86"><span class="linenos"> 86</span></a><span class="sd">        - Registers tables in the DuckDB connection.</span>
</span><span id="files_to_db-87"><a href="#files_to_db-87"><span class="linenos"> 87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="files_to_db-88"><a href="#files_to_db-88"><span class="linenos"> 88</span></a>    <span class="n">loaded_tab</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="files_to_db-89"><a href="#files_to_db-89"><span class="linenos"> 89</span></a>    <span class="n">excluded_tab</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="files_to_db-90"><a href="#files_to_db-90"><span class="linenos"> 90</span></a>    <span class="n">file_options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="files_to_db-91"><a href="#files_to_db-91"><span class="linenos"> 91</span></a>
</span><span id="files_to_db-92"><a href="#files_to_db-92"><span class="linenos"> 92</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span><span class="p">:</span>
</span><span id="files_to_db-93"><a href="#files_to_db-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">file</span><span class="p">]:</span>
</span><span id="files_to_db-94"><a href="#files_to_db-94"><span class="linenos"> 94</span></a>            <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="files_to_db-95"><a href="#files_to_db-95"><span class="linenos"> 95</span></a>
</span><span id="files_to_db-96"><a href="#files_to_db-96"><span class="linenos"> 96</span></a>            <span class="c1"># Manage zip archives</span>
</span><span id="files_to_db-97"><a href="#files_to_db-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;application/x-zip-compressed&quot;</span><span class="p">:</span>
</span><span id="files_to_db-98"><a href="#files_to_db-98"><span class="linenos"> 98</span></a>                <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">z</span><span class="p">:</span>
</span><span id="files_to_db-99"><a href="#files_to_db-99"><span class="linenos"> 99</span></a>                    <span class="k">for</span> <span class="n">zip_info</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">infolist</span><span class="p">():</span>
</span><span id="files_to_db-100"><a href="#files_to_db-100"><span class="linenos">100</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">zip_info</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="files_to_db-101"><a href="#files_to_db-101"><span class="linenos">101</span></a>                            <span class="n">_</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="files_to_db-102"><a href="#files_to_db-102"><span class="linenos">102</span></a>                            <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">file_ext</span><span class="p">:</span>
</span><span id="files_to_db-103"><a href="#files_to_db-103"><span class="linenos">103</span></a>                                <span class="k">with</span> <span class="n">z</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">zip_info</span><span class="p">)</span> <span class="k">as</span> <span class="n">zf</span><span class="p">:</span>
</span><span id="files_to_db-104"><a href="#files_to_db-104"><span class="linenos">104</span></a>                                    <span class="n">extracted_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">zf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span id="files_to_db-105"><a href="#files_to_db-105"><span class="linenos">105</span></a>                                    <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</span><span id="files_to_db-106"><a href="#files_to_db-106"><span class="linenos">106</span></a>                                    <span class="c1"># Get file options</span>
</span><span id="files_to_db-107"><a href="#files_to_db-107"><span class="linenos">107</span></a>                                    <span class="n">options</span> <span class="o">=</span> <span class="n">get_file_options</span><span class="p">(</span>
</span><span id="files_to_db-108"><a href="#files_to_db-108"><span class="linenos">108</span></a>                                        <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="files_to_db-109"><a href="#files_to_db-109"><span class="linenos">109</span></a>                                        <span class="kc">None</span> <span class="k">if</span> <span class="n">extension</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;xlsx&#39;</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">extracted_file</span><span class="p">)</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">,</span>
</span><span id="files_to_db-110"><a href="#files_to_db-110"><span class="linenos">110</span></a>                                        <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="files_to_db-111"><a href="#files_to_db-111"><span class="linenos">111</span></a>                                    <span class="p">)</span>
</span><span id="files_to_db-112"><a href="#files_to_db-112"><span class="linenos">112</span></a>
</span><span id="files_to_db-113"><a href="#files_to_db-113"><span class="linenos">113</span></a>                                    <span class="n">file_options</span><span class="p">[</span><span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="files_to_db-114"><a href="#files_to_db-114"><span class="linenos">114</span></a>                                    <span class="c1"># Load tables and register views in DuckDB</span>
</span><span id="files_to_db-115"><a href="#files_to_db-115"><span class="linenos">115</span></a>                                    <span class="n">loaded_tables</span> <span class="o">=</span> <span class="n">files_to_table</span><span class="p">(</span><span class="n">extracted_file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="files_to_db-116"><a href="#files_to_db-116"><span class="linenos">116</span></a>                                    <span class="k">if</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="files_to_db-117"><a href="#files_to_db-117"><span class="linenos">117</span></a>                                        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="files_to_db-118"><a href="#files_to_db-118"><span class="linenos">118</span></a>                                            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="files_to_db-119"><a href="#files_to_db-119"><span class="linenos">119</span></a>                                        <span class="n">loaded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">extracted_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as table(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loaded_tables</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="files_to_db-120"><a href="#files_to_db-120"><span class="linenos">120</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_db-121"><a href="#files_to_db-121"><span class="linenos">121</span></a>                                <span class="n">excluded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">zip_info</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s2"> not loaded. Unsupported file format  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="files_to_db-122"><a href="#files_to_db-122"><span class="linenos">122</span></a>            <span class="c1"># Manage single files</span>
</span><span id="files_to_db-123"><a href="#files_to_db-123"><span class="linenos">123</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_db-124"><a href="#files_to_db-124"><span class="linenos">124</span></a>                <span class="c1"># Get file options</span>
</span><span id="files_to_db-125"><a href="#files_to_db-125"><span class="linenos">125</span></a>                <span class="n">options</span> <span class="o">=</span> <span class="n">get_file_options</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;xlsx&#39;</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">)</span>
</span><span id="files_to_db-126"><a href="#files_to_db-126"><span class="linenos">126</span></a>
</span><span id="files_to_db-127"><a href="#files_to_db-127"><span class="linenos">127</span></a>                <span class="c1"># Load tables and register views in DuckDB</span>
</span><span id="files_to_db-128"><a href="#files_to_db-128"><span class="linenos">128</span></a>                <span class="n">file_options</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
</span><span id="files_to_db-129"><a href="#files_to_db-129"><span class="linenos">129</span></a>                <span class="n">loaded_tables</span> <span class="o">=</span> <span class="n">files_to_table</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</span><span id="files_to_db-130"><a href="#files_to_db-130"><span class="linenos">130</span></a>                <span class="k">if</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="files_to_db-131"><a href="#files_to_db-131"><span class="linenos">131</span></a>                    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">loaded_tables</span><span class="p">:</span>
</span><span id="files_to_db-132"><a href="#files_to_db-132"><span class="linenos">132</span></a>                        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span>
</span><span id="files_to_db-133"><a href="#files_to_db-133"><span class="linenos">133</span></a>                    <span class="n">loaded_tab</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> as table(s): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">loaded_tables</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="files_to_db-134"><a href="#files_to_db-134"><span class="linenos">134</span></a>
</span><span id="files_to_db-135"><a href="#files_to_db-135"><span class="linenos">135</span></a>    <span class="c1"># Display success and warning messages</span>
</span><span id="files_to_db-136"><a href="#files_to_db-136"><span class="linenos">136</span></a>    <span class="k">if</span> <span class="n">loaded_tab</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="files_to_db-137"><a href="#files_to_db-137"><span class="linenos">137</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">loaded_tab</span><span class="p">)</span>
</span><span id="files_to_db-138"><a href="#files_to_db-138"><span class="linenos">138</span></a>    <span class="k">if</span> <span class="n">excluded_tab</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="files_to_db-139"><a href="#files_to_db-139"><span class="linenos">139</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">excluded_tab</span><span class="p">)</span>
</span><span id="files_to_db-140"><a href="#files_to_db-140"><span class="linenos">140</span></a>
</span><span id="files_to_db-141"><a href="#files_to_db-141"><span class="linenos">141</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span>
</span></pre></div>


            <div class="docstring"><p>Loads files into a DuckDB database and registers them as tables.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>file_ext (list):</strong>  A list of file extensions to be loaded.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary mapping table names to file names.</p>
</blockquote>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>Logs messages about successfully loaded tables and excluded files.</li>
  <li>Handles zip archives and extracts supported files for loading.</li>
  <li>Registers tables in the DuckDB connection.</li>
  </ul>
</blockquote>
</div>


                </section>
                <section id="get_file_options">
                            <input id="get_file_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_file_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_name</span>, </span><span class="param"><span class="n">sheet_names</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_file_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_file_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_file_options-144"><a href="#get_file_options-144"><span class="linenos">144</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_file_options</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">sheet_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="get_file_options-145"><a href="#get_file_options-145"><span class="linenos">145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_file_options-146"><a href="#get_file_options-146"><span class="linenos">146</span></a><span class="sd">    Generates file options for CSV, TXT, and XLSX files based on user input.</span>
</span><span id="get_file_options-147"><a href="#get_file_options-147"><span class="linenos">147</span></a>
</span><span id="get_file_options-148"><a href="#get_file_options-148"><span class="linenos">148</span></a><span class="sd">    Args:</span>
</span><span id="get_file_options-149"><a href="#get_file_options-149"><span class="linenos">149</span></a><span class="sd">        file_name (str): The name of the file.</span>
</span><span id="get_file_options-150"><a href="#get_file_options-150"><span class="linenos">150</span></a><span class="sd">        sheet_names (list, optional): A list of sheet names for Excel files. Defaults to None.</span>
</span><span id="get_file_options-151"><a href="#get_file_options-151"><span class="linenos">151</span></a><span class="sd">        archive_name (str, optional): The name of the zip archive. Defaults to None.</span>
</span><span id="get_file_options-152"><a href="#get_file_options-152"><span class="linenos">152</span></a>
</span><span id="get_file_options-153"><a href="#get_file_options-153"><span class="linenos">153</span></a><span class="sd">    Returns:</span>
</span><span id="get_file_options-154"><a href="#get_file_options-154"><span class="linenos">154</span></a><span class="sd">        dict: A dictionary containing the selected options for the file or its sheets.</span>
</span><span id="get_file_options-155"><a href="#get_file_options-155"><span class="linenos">155</span></a>
</span><span id="get_file_options-156"><a href="#get_file_options-156"><span class="linenos">156</span></a><span class="sd">    Notes:</span>
</span><span id="get_file_options-157"><a href="#get_file_options-157"><span class="linenos">157</span></a><span class="sd">        - Displays Streamlit UI components for user input.</span>
</span><span id="get_file_options-158"><a href="#get_file_options-158"><span class="linenos">158</span></a><span class="sd">        - Supports options like headers, delimiters, and quoting for CSV/TXT files.</span>
</span><span id="get_file_options-159"><a href="#get_file_options-159"><span class="linenos">159</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_file_options-160"><a href="#get_file_options-160"><span class="linenos">160</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="get_file_options-161"><a href="#get_file_options-161"><span class="linenos">161</span></a>    <span class="n">label_obj</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">archive_name</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="get_file_options-162"><a href="#get_file_options-162"><span class="linenos">162</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="get_file_options-163"><a href="#get_file_options-163"><span class="linenos">163</span></a>    <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">]:</span>
</span><span id="get_file_options-164"><a href="#get_file_options-164"><span class="linenos">164</span></a>        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File Settings - </span><span class="si">{</span><span class="n">label_obj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="get_file_options-165"><a href="#get_file_options-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="get_file_options-166"><a href="#get_file_options-166"><span class="linenos">166</span></a>                <span class="n">left_column</span><span class="p">,</span> <span class="n">right_column</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="get_file_options-167"><a href="#get_file_options-167"><span class="linenos">167</span></a>                <span class="n">options</span><span class="p">[</span><span class="s1">&#39;sheets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="get_file_options-168"><a href="#get_file_options-168"><span class="linenos">168</span></a>                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sheet_names</span><span class="p">):</span>
</span><span id="get_file_options-169"><a href="#get_file_options-169"><span class="linenos">169</span></a>                    <span class="k">with</span> <span class="n">left_column</span> <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">right_column</span><span class="p">:</span>
</span><span id="get_file_options-170"><a href="#get_file_options-170"><span class="linenos">170</span></a>                        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;sheets&#39;</span><span class="p">][</span><span class="n">sheet</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="get_file_options-171"><a href="#get_file_options-171"><span class="linenos">171</span></a>                            <span class="s1">&#39;header&#39;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="get_file_options-172"><a href="#get_file_options-172"><span class="linenos">172</span></a>                                <span class="sa">f</span><span class="s2">&quot;Header for </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">sheet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="get_file_options-173"><a href="#get_file_options-173"><span class="linenos">173</span></a>                                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="get_file_options-174"><a href="#get_file_options-174"><span class="linenos">174</span></a>                                <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span>
</span><span id="get_file_options-175"><a href="#get_file_options-175"><span class="linenos">175</span></a>                                <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;header_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sheet</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="get_file_options-176"><a href="#get_file_options-176"><span class="linenos">176</span></a>                            <span class="p">)</span>
</span><span id="get_file_options-177"><a href="#get_file_options-177"><span class="linenos">177</span></a>                        <span class="p">}</span>
</span><span id="get_file_options-178"><a href="#get_file_options-178"><span class="linenos">178</span></a>            <span class="k">elif</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="get_file_options-179"><a href="#get_file_options-179"><span class="linenos">179</span></a>                <span class="n">left_column</span><span class="p">,</span> <span class="n">right_column</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="get_file_options-180"><a href="#get_file_options-180"><span class="linenos">180</span></a>                <span class="k">with</span> <span class="n">left_column</span><span class="p">:</span>
</span><span id="get_file_options-181"><a href="#get_file_options-181"><span class="linenos">181</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="get_file_options-182"><a href="#get_file_options-182"><span class="linenos">182</span></a>                        <span class="sa">f</span><span class="s2">&quot;Header&quot;</span><span class="p">,</span>
</span><span id="get_file_options-183"><a href="#get_file_options-183"><span class="linenos">183</span></a>                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="get_file_options-184"><a href="#get_file_options-184"><span class="linenos">184</span></a>                        <span class="n">format_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;No&quot;</span><span class="p">,</span>
</span><span id="get_file_options-185"><a href="#get_file_options-185"><span class="linenos">185</span></a>                        <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;header_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="get_file_options-186"><a href="#get_file_options-186"><span class="linenos">186</span></a>                    <span class="p">)</span>
</span><span id="get_file_options-187"><a href="#get_file_options-187"><span class="linenos">187</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;delimiter_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="get_file_options-188"><a href="#get_file_options-188"><span class="linenos">188</span></a>                <span class="k">with</span> <span class="n">right_column</span><span class="p">:</span>
</span><span id="get_file_options-189"><a href="#get_file_options-189"><span class="linenos">189</span></a>                    <span class="n">quoting_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="get_file_options-190"><a href="#get_file_options-190"><span class="linenos">190</span></a>                        <span class="s1">&#39;QUOTE_ALL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_ALL</span><span class="p">,</span>
</span><span id="get_file_options-191"><a href="#get_file_options-191"><span class="linenos">191</span></a>                        <span class="s1">&#39;QUOTE_MINIMAL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">,</span>
</span><span id="get_file_options-192"><a href="#get_file_options-192"><span class="linenos">192</span></a>                        <span class="s1">&#39;QUOTE_NONNUMERIC&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span>
</span><span id="get_file_options-193"><a href="#get_file_options-193"><span class="linenos">193</span></a>                        <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">,</span>
</span><span id="get_file_options-194"><a href="#get_file_options-194"><span class="linenos">194</span></a>                    <span class="p">}</span>
</span><span id="get_file_options-195"><a href="#get_file_options-195"><span class="linenos">195</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;quoting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span>
</span><span id="get_file_options-196"><a href="#get_file_options-196"><span class="linenos">196</span></a>                        <span class="sa">f</span><span class="s2">&quot;Quoting&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">quoting_options</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;quoting_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="get_file_options-197"><a href="#get_file_options-197"><span class="linenos">197</span></a>                    <span class="p">)</span>
</span><span id="get_file_options-198"><a href="#get_file_options-198"><span class="linenos">198</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;quotechar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quote character&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;quote_</span><span class="si">{</span><span class="n">archive_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="get_file_options-199"><a href="#get_file_options-199"><span class="linenos">199</span></a>                    <span class="n">options</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;str&quot;</span>
</span><span id="get_file_options-200"><a href="#get_file_options-200"><span class="linenos">200</span></a>    <span class="k">return</span> <span class="n">options</span>
</span></pre></div>


            <div class="docstring"><p>Generates file options for CSV, TXT, and XLSX files based on user input.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>file_name (str):</strong>  The name of the file.</li>
<li><strong>sheet_names (list, optional):</strong>  A list of sheet names for Excel files. Defaults to None.</li>
<li><strong>archive_name (str, optional):</strong>  The name of the zip archive. Defaults to None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>dict: A dictionary containing the selected options for the file or its sheets.</p>
</blockquote>

<h6 id="notes">Notes:</h6>

<blockquote>
  <ul>
  <li>Displays Streamlit UI components for user input.</li>
  <li>Supports options like headers, delimiters, and quoting for CSV/TXT files.</li>
  </ul>
</blockquote>
</div>


                </section>
                <section id="files_to_table">
                            <input id="files_to_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">files_to_table</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file</span>, </span><span class="param"><span class="n">con</span>, </span><span class="param"><span class="n">options</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="files_to_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#files_to_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="files_to_table-203"><a href="#files_to_table-203"><span class="linenos">203</span></a><span class="k">def</span><span class="w"> </span><span class="nf">files_to_table</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">archive_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="files_to_table-204"><a href="#files_to_table-204"><span class="linenos">204</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="files_to_table-205"><a href="#files_to_table-205"><span class="linenos">205</span></a><span class="sd">    Get dataframe from file and register it in a database connection.</span>
</span><span id="files_to_table-206"><a href="#files_to_table-206"><span class="linenos">206</span></a>
</span><span id="files_to_table-207"><a href="#files_to_table-207"><span class="linenos">207</span></a><span class="sd">    Args:</span>
</span><span id="files_to_table-208"><a href="#files_to_table-208"><span class="linenos">208</span></a><span class="sd">        file: File object or path to the file.</span>
</span><span id="files_to_table-209"><a href="#files_to_table-209"><span class="linenos">209</span></a><span class="sd">        con: Database connection object.</span>
</span><span id="files_to_table-210"><a href="#files_to_table-210"><span class="linenos">210</span></a><span class="sd">        options: Dict of options for file loading.</span>
</span><span id="files_to_table-211"><a href="#files_to_table-211"><span class="linenos">211</span></a><span class="sd">        archive_name: Name of the zip archive.</span>
</span><span id="files_to_table-212"><a href="#files_to_table-212"><span class="linenos">212</span></a>
</span><span id="files_to_table-213"><a href="#files_to_table-213"><span class="linenos">213</span></a><span class="sd">    Returns:</span>
</span><span id="files_to_table-214"><a href="#files_to_table-214"><span class="linenos">214</span></a><span class="sd">        table_names(List): List of table names where the data was registered, or None if there was an error.</span>
</span><span id="files_to_table-215"><a href="#files_to_table-215"><span class="linenos">215</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="files_to_table-216"><a href="#files_to_table-216"><span class="linenos">216</span></a>    <span class="c1"># Get file extension, file name, and archive name</span>
</span><span id="files_to_table-217"><a href="#files_to_table-217"><span class="linenos">217</span></a>    <span class="n">file_extension</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="files_to_table-218"><a href="#files_to_table-218"><span class="linenos">218</span></a>    <span class="n">file_nm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">archive_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">archive_name</span> <span class="k">else</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
</span><span id="files_to_table-219"><a href="#files_to_table-219"><span class="linenos">219</span></a>    <span class="n">table_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="files_to_table-220"><a href="#files_to_table-220"><span class="linenos">220</span></a>
</span><span id="files_to_table-221"><a href="#files_to_table-221"><span class="linenos">221</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="files_to_table-222"><a href="#files_to_table-222"><span class="linenos">222</span></a>        <span class="c1"># Manage CSV and TXT using collected file settings</span>
</span><span id="files_to_table-223"><a href="#files_to_table-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="files_to_table-224"><a href="#files_to_table-224"><span class="linenos">224</span></a>            <span class="n">delim</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">t&#39;</span> <span class="k">else</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span>
</span><span id="files_to_table-225"><a href="#files_to_table-225"><span class="linenos">225</span></a>            <span class="c1"># Read CSV using utf-8 encoding</span>
</span><span id="files_to_table-226"><a href="#files_to_table-226"><span class="linenos">226</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="files_to_table-227"><a href="#files_to_table-227"><span class="linenos">227</span></a>                <span class="n">file</span><span class="p">,</span>
</span><span id="files_to_table-228"><a href="#files_to_table-228"><span class="linenos">228</span></a>                <span class="n">sep</span><span class="o">=</span><span class="n">delim</span><span class="p">,</span>
</span><span id="files_to_table-229"><a href="#files_to_table-229"><span class="linenos">229</span></a>                <span class="n">quoting</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">csv</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quoting&#39;</span><span class="p">,</span> <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">)),</span>
</span><span id="files_to_table-230"><a href="#files_to_table-230"><span class="linenos">230</span></a>                <span class="n">quotechar</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quotechar&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">),</span>
</span><span id="files_to_table-231"><a href="#files_to_table-231"><span class="linenos">231</span></a>                <span class="n">header</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="files_to_table-232"><a href="#files_to_table-232"><span class="linenos">232</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
</span><span id="files_to_table-233"><a href="#files_to_table-233"><span class="linenos">233</span></a>                <span class="n">on_bad_lines</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">,</span>
</span><span id="files_to_table-234"><a href="#files_to_table-234"><span class="linenos">234</span></a>                <span class="n">encoding_errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
</span><span id="files_to_table-235"><a href="#files_to_table-235"><span class="linenos">235</span></a>            <span class="p">)</span>
</span><span id="files_to_table-236"><a href="#files_to_table-236"><span class="linenos">236</span></a>            <span class="c1"># In case of no header, rename columns from simple integer to col_integer</span>
</span><span id="files_to_table-237"><a href="#files_to_table-237"><span class="linenos">237</span></a>            <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="files_to_table-238"><a href="#files_to_table-238"><span class="linenos">238</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
</span><span id="files_to_table-239"><a href="#files_to_table-239"><span class="linenos">239</span></a>        <span class="c1"># Manage XLSX using header settings collected</span>
</span><span id="files_to_table-240"><a href="#files_to_table-240"><span class="linenos">240</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="files_to_table-241"><a href="#files_to_table-241"><span class="linenos">241</span></a>            <span class="n">xls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="files_to_table-242"><a href="#files_to_table-242"><span class="linenos">242</span></a>            <span class="n">dfs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="files_to_table-243"><a href="#files_to_table-243"><span class="linenos">243</span></a>            <span class="c1"># Loop all sheets and in case of no header, rename columns from simple integer to col_integer</span>
</span><span id="files_to_table-244"><a href="#files_to_table-244"><span class="linenos">244</span></a>            <span class="k">for</span> <span class="n">sheet_name</span> <span class="ow">in</span> <span class="n">xls</span><span class="o">.</span><span class="n">sheet_names</span><span class="p">:</span>
</span><span id="files_to_table-245"><a href="#files_to_table-245"><span class="linenos">245</span></a>                <span class="n">sheet_options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sheets&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="files_to_table-246"><a href="#files_to_table-246"><span class="linenos">246</span></a>                <span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">sheet_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="files_to_table-247"><a href="#files_to_table-247"><span class="linenos">247</span></a>                <span class="k">if</span> <span class="n">sheet_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="files_to_table-248"><a href="#files_to_table-248"><span class="linenos">248</span></a>                    <span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;col_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
</span><span id="files_to_table-249"><a href="#files_to_table-249"><span class="linenos">249</span></a>        <span class="c1"># Manage other accepted file formats</span>
</span><span id="files_to_table-250"><a href="#files_to_table-250"><span class="linenos">250</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="files_to_table-251"><a href="#files_to_table-251"><span class="linenos">251</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="files_to_table-252"><a href="#files_to_table-252"><span class="linenos">252</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;avro&#39;</span><span class="p">:</span>
</span><span id="files_to_table-253"><a href="#files_to_table-253"><span class="linenos">253</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pdx</span><span class="o">.</span><span class="n">read_avro</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">na_dtypes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="files_to_table-254"><a href="#files_to_table-254"><span class="linenos">254</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="files_to_table-255"><a href="#files_to_table-255"><span class="linenos">255</span></a>            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="files_to_table-256"><a href="#files_to_table-256"><span class="linenos">256</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="files_to_table-257"><a href="#files_to_table-257"><span class="linenos">257</span></a>                <span class="c1"># It&#39;s a single object</span>
</span><span id="files_to_table-258"><a href="#files_to_table-258"><span class="linenos">258</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">json_data</span><span class="p">])</span>
</span><span id="files_to_table-259"><a href="#files_to_table-259"><span class="linenos">259</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_table-260"><a href="#files_to_table-260"><span class="linenos">260</span></a>                <span class="c1"># It&#39;s a list of objects</span>
</span><span id="files_to_table-261"><a href="#files_to_table-261"><span class="linenos">261</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="files_to_table-262"><a href="#files_to_table-262"><span class="linenos">262</span></a>        <span class="k">elif</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
</span><span id="files_to_table-263"><a href="#files_to_table-263"><span class="linenos">263</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_xml</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="files_to_table-264"><a href="#files_to_table-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_table-265"><a href="#files_to_table-265"><span class="linenos">265</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not loaded. Unsupported file format.&quot;</span><span class="p">)</span>
</span><span id="files_to_table-266"><a href="#files_to_table-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="files_to_table-267"><a href="#files_to_table-267"><span class="linenos">267</span></a>
</span><span id="files_to_table-268"><a href="#files_to_table-268"><span class="linenos">268</span></a>        <span class="c1"># Register dataframes into DuckDB</span>
</span><span id="files_to_table-269"><a href="#files_to_table-269"><span class="linenos">269</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="files_to_table-270"><a href="#files_to_table-270"><span class="linenos">270</span></a>            <span class="k">for</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="files_to_table-271"><a href="#files_to_table-271"><span class="linenos">271</span></a>                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sheet_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="files_to_table-272"><a href="#files_to_table-272"><span class="linenos">272</span></a>                <span class="n">table_name</span> <span class="o">=</span> <span class="n">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_nm</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sheet_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="files_to_table-273"><a href="#files_to_table-273"><span class="linenos">273</span></a>                <span class="n">table_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="files_to_table-274"><a href="#files_to_table-274"><span class="linenos">274</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_table-275"><a href="#files_to_table-275"><span class="linenos">275</span></a>            <span class="n">table_name</span> <span class="o">=</span> <span class="n">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_nm</span><span class="p">)</span>
</span><span id="files_to_table-276"><a href="#files_to_table-276"><span class="linenos">276</span></a>            <span class="n">table_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
</span><span id="files_to_table-277"><a href="#files_to_table-277"><span class="linenos">277</span></a>
</span><span id="files_to_table-278"><a href="#files_to_table-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">table_names</span>
</span><span id="files_to_table-279"><a href="#files_to_table-279"><span class="linenos">279</span></a>
</span><span id="files_to_table-280"><a href="#files_to_table-280"><span class="linenos">280</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="files_to_table-281"><a href="#files_to_table-281"><span class="linenos">281</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="files_to_table-282"><a href="#files_to_table-282"><span class="linenos">282</span></a>        <span class="c1"># Manage exception of wrong file settings provided for CSV and TXT</span>
</span><span id="files_to_table-283"><a href="#files_to_table-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;Error tokenizing data&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="files_to_table-284"><a href="#files_to_table-284"><span class="linenos">284</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> not loaded. Please check file settings.&#39;</span><span class="p">)</span>
</span><span id="files_to_table-285"><a href="#files_to_table-285"><span class="linenos">285</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="files_to_table-286"><a href="#files_to_table-286"><span class="linenos">286</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="files_to_table-287"><a href="#files_to_table-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get dataframe from file and register it in a database connection.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>file:</strong>  File object or path to the file.</li>
<li><strong>con:</strong>  Database connection object.</li>
<li><strong>options:</strong>  Dict of options for file loading.</li>
<li><strong>archive_name:</strong>  Name of the zip archive.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>table_names(List): List of table names where the data was registered, or None if there was an error.</p>
</blockquote>
</div>


                </section>
                <section id="register_dataframe">
                            <input id="register_dataframe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_dataframe</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">con</span>, </span><span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">file_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="register_dataframe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#register_dataframe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="register_dataframe-290"><a href="#register_dataframe-290"><span class="linenos">290</span></a><span class="k">def</span><span class="w"> </span><span class="nf">register_dataframe</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
</span><span id="register_dataframe-291"><a href="#register_dataframe-291"><span class="linenos">291</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="register_dataframe-292"><a href="#register_dataframe-292"><span class="linenos">292</span></a><span class="sd">    Register a DataFrame in the connection object.</span>
</span><span id="register_dataframe-293"><a href="#register_dataframe-293"><span class="linenos">293</span></a>
</span><span id="register_dataframe-294"><a href="#register_dataframe-294"><span class="linenos">294</span></a><span class="sd">    Args:</span>
</span><span id="register_dataframe-295"><a href="#register_dataframe-295"><span class="linenos">295</span></a><span class="sd">        con (Connection): The connection object to register the DataFrame.</span>
</span><span id="register_dataframe-296"><a href="#register_dataframe-296"><span class="linenos">296</span></a><span class="sd">        df (pd.DataFrame): The DataFrame to register.</span>
</span><span id="register_dataframe-297"><a href="#register_dataframe-297"><span class="linenos">297</span></a><span class="sd">        file_name (str): The name of the file (used to generate the table name).</span>
</span><span id="register_dataframe-298"><a href="#register_dataframe-298"><span class="linenos">298</span></a>
</span><span id="register_dataframe-299"><a href="#register_dataframe-299"><span class="linenos">299</span></a><span class="sd">    Returns:</span>
</span><span id="register_dataframe-300"><a href="#register_dataframe-300"><span class="linenos">300</span></a><span class="sd">        table_name(str): The name of the registered table.</span>
</span><span id="register_dataframe-301"><a href="#register_dataframe-301"><span class="linenos">301</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="register_dataframe-302"><a href="#register_dataframe-302"><span class="linenos">302</span></a>    <span class="c1"># Clean table name</span>
</span><span id="register_dataframe-303"><a href="#register_dataframe-303"><span class="linenos">303</span></a>    <span class="n">table_name</span> <span class="o">=</span> <span class="n">clean_table_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</span><span id="register_dataframe-304"><a href="#register_dataframe-304"><span class="linenos">304</span></a>
</span><span id="register_dataframe-305"><a href="#register_dataframe-305"><span class="linenos">305</span></a>    <span class="c1"># Register view in db</span>
</span><span id="register_dataframe-306"><a href="#register_dataframe-306"><span class="linenos">306</span></a>    <span class="n">con</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span><span id="register_dataframe-307"><a href="#register_dataframe-307"><span class="linenos">307</span></a>    <span class="k">return</span> <span class="n">table_name</span>
</span></pre></div>


            <div class="docstring"><p>Register a DataFrame in the connection object.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>con (Connection):</strong>  The connection object to register the DataFrame.</li>
<li><strong>df (pd.DataFrame):</strong>  The DataFrame to register.</li>
<li><strong>file_name (str):</strong>  The name of the file (used to generate the table name).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>table_name(str): The name of the registered table.</p>
</blockquote>
</div>


                </section>
                <section id="clean_table_name">
                            <input id="clean_table_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clean_table_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="clean_table_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#clean_table_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="clean_table_name-310"><a href="#clean_table_name-310"><span class="linenos">310</span></a><span class="k">def</span><span class="w"> </span><span class="nf">clean_table_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="clean_table_name-311"><a href="#clean_table_name-311"><span class="linenos">311</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="clean_table_name-312"><a href="#clean_table_name-312"><span class="linenos">312</span></a><span class="sd">    Cleans the table name by replacing spaces with underscores and removing all other special characters.</span>
</span><span id="clean_table_name-313"><a href="#clean_table_name-313"><span class="linenos">313</span></a><span class="sd">    Adds an underscore if the name starts or ends with a number.</span>
</span><span id="clean_table_name-314"><a href="#clean_table_name-314"><span class="linenos">314</span></a>
</span><span id="clean_table_name-315"><a href="#clean_table_name-315"><span class="linenos">315</span></a><span class="sd">    Args:</span>
</span><span id="clean_table_name-316"><a href="#clean_table_name-316"><span class="linenos">316</span></a><span class="sd">        name (str): The table name to be cleaned.</span>
</span><span id="clean_table_name-317"><a href="#clean_table_name-317"><span class="linenos">317</span></a>
</span><span id="clean_table_name-318"><a href="#clean_table_name-318"><span class="linenos">318</span></a><span class="sd">    Returns:</span>
</span><span id="clean_table_name-319"><a href="#clean_table_name-319"><span class="linenos">319</span></a><span class="sd">        name(str): The cleaned table name.</span>
</span><span id="clean_table_name-320"><a href="#clean_table_name-320"><span class="linenos">320</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="clean_table_name-321"><a href="#clean_table_name-321"><span class="linenos">321</span></a>    <span class="c1"># Replace spaces with underscores</span>
</span><span id="clean_table_name-322"><a href="#clean_table_name-322"><span class="linenos">322</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="clean_table_name-323"><a href="#clean_table_name-323"><span class="linenos">323</span></a>    <span class="c1"># Remove all other special characters</span>
</span><span id="clean_table_name-324"><a href="#clean_table_name-324"><span class="linenos">324</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9_]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="clean_table_name-325"><a href="#clean_table_name-325"><span class="linenos">325</span></a>
</span><span id="clean_table_name-326"><a href="#clean_table_name-326"><span class="linenos">326</span></a>    <span class="c1"># Add an underscore if the name starts with a number</span>
</span><span id="clean_table_name-327"><a href="#clean_table_name-327"><span class="linenos">327</span></a>    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
</span><span id="clean_table_name-328"><a href="#clean_table_name-328"><span class="linenos">328</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="clean_table_name-329"><a href="#clean_table_name-329"><span class="linenos">329</span></a>    <span class="c1"># Add an underscore if the name ends with a number</span>
</span><span id="clean_table_name-330"><a href="#clean_table_name-330"><span class="linenos">330</span></a>    <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
</span><span id="clean_table_name-331"><a href="#clean_table_name-331"><span class="linenos">331</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_&quot;</span>
</span><span id="clean_table_name-332"><a href="#clean_table_name-332"><span class="linenos">332</span></a>
</span><span id="clean_table_name-333"><a href="#clean_table_name-333"><span class="linenos">333</span></a>    <span class="k">return</span> <span class="n">name</span>
</span></pre></div>


            <div class="docstring"><p>Cleans the table name by replacing spaces with underscores and removing all other special characters.
Adds an underscore if the name starts or ends with a number.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>name (str):</strong>  The table name to be cleaned.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>name(str): The cleaned table name.</p>
</blockquote>
</div>


                </section>
                <section id="get_preview_data">
                            <input id="get_preview_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_preview_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">con</span>, </span><span class="param"><span class="n">table_name</span>, </span><span class="param"><span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_preview_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_preview_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_preview_data-336"><a href="#get_preview_data-336"><span class="linenos">336</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_preview_data</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="get_preview_data-337"><a href="#get_preview_data-337"><span class="linenos">337</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_preview_data-338"><a href="#get_preview_data-338"><span class="linenos">338</span></a><span class="sd">    Get preview data for a given table.</span>
</span><span id="get_preview_data-339"><a href="#get_preview_data-339"><span class="linenos">339</span></a>
</span><span id="get_preview_data-340"><a href="#get_preview_data-340"><span class="linenos">340</span></a><span class="sd">    Args:</span>
</span><span id="get_preview_data-341"><a href="#get_preview_data-341"><span class="linenos">341</span></a><span class="sd">        con (Connection): The DuckDB connection object.</span>
</span><span id="get_preview_data-342"><a href="#get_preview_data-342"><span class="linenos">342</span></a><span class="sd">        table_name (str): The name of the table to preview.</span>
</span><span id="get_preview_data-343"><a href="#get_preview_data-343"><span class="linenos">343</span></a><span class="sd">        num_rows (int): The number of rows to preview.</span>
</span><span id="get_preview_data-344"><a href="#get_preview_data-344"><span class="linenos">344</span></a>
</span><span id="get_preview_data-345"><a href="#get_preview_data-345"><span class="linenos">345</span></a><span class="sd">    Returns:</span>
</span><span id="get_preview_data-346"><a href="#get_preview_data-346"><span class="linenos">346</span></a><span class="sd">        df(pandas.DataFrame): A DataFrame containing the preview data.</span>
</span><span id="get_preview_data-347"><a href="#get_preview_data-347"><span class="linenos">347</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_preview_data-348"><a href="#get_preview_data-348"><span class="linenos">348</span></a>    <span class="c1"># Get first 5 rows of the table</span>
</span><span id="get_preview_data-349"><a href="#get_preview_data-349"><span class="linenos">349</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;SELECT * FROM &quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot; LIMIT </span><span class="si">{</span><span class="n">num_rows</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="get_preview_data-350"><a href="#get_preview_data-350"><span class="linenos">350</span></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="get_preview_data-351"><a href="#get_preview_data-351"><span class="linenos">351</span></a>    <span class="c1"># Reset index to start from 1</span>
</span><span id="get_preview_data-352"><a href="#get_preview_data-352"><span class="linenos">352</span></a>    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="get_preview_data-353"><a href="#get_preview_data-353"><span class="linenos">353</span></a>    <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Get preview data for a given table.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>con (Connection):</strong>  The DuckDB connection object.</li>
<li><strong>table_name (str):</strong>  The name of the table to preview.</li>
<li><strong>num_rows (int):</strong>  The number of rows to preview.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>df(pandas.DataFrame): A DataFrame containing the preview data.</p>
</blockquote>
</div>


                </section>
                <section id="data_preview">
                            <input id="data_preview-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">data_preview</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="data_preview-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#data_preview"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="data_preview-356"><a href="#data_preview-356"><span class="linenos">356</span></a><span class="k">def</span><span class="w"> </span><span class="nf">data_preview</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="data_preview-357"><a href="#data_preview-357"><span class="linenos">357</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="data_preview-358"><a href="#data_preview-358"><span class="linenos">358</span></a><span class="sd">    Display data preview for each table.</span>
</span><span id="data_preview-359"><a href="#data_preview-359"><span class="linenos">359</span></a>
</span><span id="data_preview-360"><a href="#data_preview-360"><span class="linenos">360</span></a><span class="sd">    Args:</span>
</span><span id="data_preview-361"><a href="#data_preview-361"><span class="linenos">361</span></a><span class="sd">        num_rows (int): The number of rows to preview.</span>
</span><span id="data_preview-362"><a href="#data_preview-362"><span class="linenos">362</span></a>
</span><span id="data_preview-363"><a href="#data_preview-363"><span class="linenos">363</span></a><span class="sd">    Returns:</span>
</span><span id="data_preview-364"><a href="#data_preview-364"><span class="linenos">364</span></a><span class="sd">        st.dataframe(preview_df): The preview of the selected table.</span>
</span><span id="data_preview-365"><a href="#data_preview-365"><span class="linenos">365</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="data_preview-366"><a href="#data_preview-366"><span class="linenos">366</span></a>    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Data Preview&quot;</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="data_preview-367"><a href="#data_preview-367"><span class="linenos">367</span></a>        <span class="n">tab_prev</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s1">&#39;Select Table:&#39;</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="data_preview-368"><a href="#data_preview-368"><span class="linenos">368</span></a>        <span class="n">preview_df</span> <span class="o">=</span> <span class="n">get_preview_data</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">tab_prev</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">)</span>
</span><span id="data_preview-369"><a href="#data_preview-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">preview_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Display data preview for each table.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>num_rows (int):</strong>  The number of rows to preview.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>st.dataframe(preview_df): The preview of the selected table.</p>
</blockquote>
</div>


                </section>
                <section id="get_query">
                            <input id="get_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_query</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_query-372"><a href="#get_query-372"><span class="linenos">372</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_query</span><span class="p">():</span>
</span><span id="get_query-373"><a href="#get_query-373"><span class="linenos">373</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_query-374"><a href="#get_query-374"><span class="linenos">374</span></a><span class="sd">    Function to get user input for SQL query and execute it, with table/column suggestions.</span>
</span><span id="get_query-375"><a href="#get_query-375"><span class="linenos">375</span></a>
</span><span id="get_query-376"><a href="#get_query-376"><span class="linenos">376</span></a><span class="sd">    Returns:</span>
</span><span id="get_query-377"><a href="#get_query-377"><span class="linenos">377</span></a><span class="sd">        st.session_state.query_result(pd.DataFrame): The result of the executed query, or None if no query was entered.</span>
</span><span id="get_query-378"><a href="#get_query-378"><span class="linenos">378</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_query-379"><a href="#get_query-379"><span class="linenos">379</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Query Data&quot;</span><span class="p">)</span>
</span><span id="get_query-380"><a href="#get_query-380"><span class="linenos">380</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">caption</span><span class="p">(</span><span class="s2">&quot;Type your SQL query below and press </span><span class="se">\&quot;</span><span class="s2">Ctrl + Enter</span><span class="se">\&quot;</span><span class="s2"> to run it.&quot;</span><span class="p">)</span>
</span><span id="get_query-381"><a href="#get_query-381"><span class="linenos">381</span></a>    <span class="c1"># Define SQL completions based on loaded tables and columns</span>
</span><span id="get_query-382"><a href="#get_query-382"><span class="linenos">382</span></a>    <span class="n">sql_completions</span><span class="p">()</span>
</span><span id="get_query-383"><a href="#get_query-383"><span class="linenos">383</span></a>    
</span><span id="get_query-384"><a href="#get_query-384"><span class="linenos">384</span></a>    <span class="c1"># Define action to submit written query. Ctrl + Enter or mouse click</span>
</span><span id="get_query-385"><a href="#get_query-385"><span class="linenos">385</span></a>    <span class="n">query_btn</span> <span class="o">=</span> <span class="p">[{</span>
</span><span id="get_query-386"><a href="#get_query-386"><span class="linenos">386</span></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Run&quot;</span><span class="p">,</span>
</span><span id="get_query-387"><a href="#get_query-387"><span class="linenos">387</span></a>        <span class="s2">&quot;feather&quot;</span><span class="p">:</span> <span class="s2">&quot;Play&quot;</span><span class="p">,</span>
</span><span id="get_query-388"><a href="#get_query-388"><span class="linenos">388</span></a>        <span class="s2">&quot;primary&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="get_query-389"><a href="#get_query-389"><span class="linenos">389</span></a>        <span class="s2">&quot;hasText&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="get_query-390"><a href="#get_query-390"><span class="linenos">390</span></a>        <span class="s2">&quot;showWithIcon&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="get_query-391"><a href="#get_query-391"><span class="linenos">391</span></a>        <span class="s2">&quot;commands&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;saveState&quot;</span><span class="p">,</span><span class="s2">&quot;submit&quot;</span><span class="p">],</span>
</span><span id="get_query-392"><a href="#get_query-392"><span class="linenos">392</span></a>        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="s2">&quot;0.44rem&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;0.4rem&quot;</span><span class="p">},</span>
</span><span id="get_query-393"><a href="#get_query-393"><span class="linenos">393</span></a>        <span class="s2">&quot;alwaysOn&quot;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="get_query-394"><a href="#get_query-394"><span class="linenos">394</span></a>    <span class="p">}]</span>
</span><span id="get_query-395"><a href="#get_query-395"><span class="linenos">395</span></a>
</span><span id="get_query-396"><a href="#get_query-396"><span class="linenos">396</span></a>    <span class="c1"># Define code editor options</span>
</span><span id="get_query-397"><a href="#get_query-397"><span class="linenos">397</span></a>    <span class="n">sql_query_input</span> <span class="o">=</span> <span class="n">code_editor</span><span class="p">(</span>
</span><span id="get_query-398"><a href="#get_query-398"><span class="linenos">398</span></a>        <span class="n">code</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">,</span>
</span><span id="get_query-399"><a href="#get_query-399"><span class="linenos">399</span></a>        <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;sql&#39;</span><span class="p">,</span>
</span><span id="get_query-400"><a href="#get_query-400"><span class="linenos">400</span></a>        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;enableBasicAutocompletion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;enableLiveAutocompletion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="get_query-401"><a href="#get_query-401"><span class="linenos">401</span></a>        <span class="n">completions</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="p">,</span>
</span><span id="get_query-402"><a href="#get_query-402"><span class="linenos">402</span></a>        <span class="n">height</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
</span><span id="get_query-403"><a href="#get_query-403"><span class="linenos">403</span></a>        <span class="n">buttons</span><span class="o">=</span><span class="n">query_btn</span><span class="p">,</span>
</span><span id="get_query-404"><a href="#get_query-404"><span class="linenos">404</span></a>        <span class="n">shortcuts</span><span class="o">=</span><span class="s2">&quot;vscode&quot;</span><span class="p">,</span>
</span><span id="get_query-405"><a href="#get_query-405"><span class="linenos">405</span></a>        <span class="n">focus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="get_query-406"><a href="#get_query-406"><span class="linenos">406</span></a>        <span class="n">props</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;highlightActiveLine&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="get_query-407"><a href="#get_query-407"><span class="linenos">407</span></a>        <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;sql_query_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="get_query-408"><a href="#get_query-408"><span class="linenos">408</span></a>        <span class="n">allow_reset</span><span class="o">=</span><span class="kc">False</span>
</span><span id="get_query-409"><a href="#get_query-409"><span class="linenos">409</span></a>    <span class="p">)</span>
</span><span id="get_query-410"><a href="#get_query-410"><span class="linenos">410</span></a>
</span><span id="get_query-411"><a href="#get_query-411"><span class="linenos">411</span></a>    <span class="c1"># Get SQL query from code editor once sumitted</span>
</span><span id="get_query-412"><a href="#get_query-412"><span class="linenos">412</span></a>    <span class="k">if</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="ow">and</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="get_query-413"><a href="#get_query-413"><span class="linenos">413</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="n">sql_query_input</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="get_query-414"><a href="#get_query-414"><span class="linenos">414</span></a>
</span><span id="get_query-415"><a href="#get_query-415"><span class="linenos">415</span></a>    <span class="c1"># Button to run query</span>
</span><span id="get_query-416"><a href="#get_query-416"><span class="linenos">416</span></a>    <span class="c1">#if st.button(&quot;Run Query&quot;):</span>
</span><span id="get_query-417"><a href="#get_query-417"><span class="linenos">417</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">:</span>
</span><span id="get_query-418"><a href="#get_query-418"><span class="linenos">418</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="get_query-419"><a href="#get_query-419"><span class="linenos">419</span></a>            <span class="c1"># Run query</span>
</span><span id="get_query-420"><a href="#get_query-420"><span class="linenos">420</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="get_query-421"><a href="#get_query-421"><span class="linenos">421</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="get_query-422"><a href="#get_query-422"><span class="linenos">422</span></a>            <span class="n">result_df</span> <span class="o">=</span> <span class="n">run_query</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span><span class="p">)</span>
</span><span id="get_query-423"><a href="#get_query-423"><span class="linenos">423</span></a>            <span class="c1"># Reset index to start from 1 for query results</span>
</span><span id="get_query-424"><a href="#get_query-424"><span class="linenos">424</span></a>            <span class="n">result_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_df</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="get_query-425"><a href="#get_query-425"><span class="linenos">425</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="n">result_df</span>
</span><span id="get_query-426"><a href="#get_query-426"><span class="linenos">426</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&quot;Query executed successfully!&quot;</span><span class="p">)</span>
</span><span id="get_query-427"><a href="#get_query-427"><span class="linenos">427</span></a>        <span class="c1"># Catch exception of wrong table name and update command</span>
</span><span id="get_query-428"><a href="#get_query-428"><span class="linenos">428</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="get_query-429"><a href="#get_query-429"><span class="linenos">429</span></a>            <span class="k">if</span> <span class="s2">&quot;Catalog Error: Table with name&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="get_query-430"><a href="#get_query-430"><span class="linenos">430</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table not existing. Please check table names in your query.&quot;</span><span class="p">)</span>
</span><span id="get_query-431"><a href="#get_query-431"><span class="linenos">431</span></a>            <span class="k">elif</span> <span class="s2">&quot;Can only update base table&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="get_query-432"><a href="#get_query-432"><span class="linenos">432</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Update not available. Please consider a different select statement and the edit mode.&quot;</span><span class="p">)</span>
</span><span id="get_query-433"><a href="#get_query-433"><span class="linenos">433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="get_query-434"><a href="#get_query-434"><span class="linenos">434</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error executing query: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="get_query-435"><a href="#get_query-435"><span class="linenos">435</span></a>    <span class="c1">#:</span>
</span><span id="get_query-436"><a href="#get_query-436"><span class="linenos">436</span></a>    <span class="c1">#    st.warning(&quot;Please enter a SQL query.&quot;)</span>
</span></pre></div>


            <div class="docstring"><p>Function to get user input for SQL query and execute it, with table/column suggestions.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>st.session_state.query_result(pd.DataFrame): The result of the executed query, or None if no query was entered.</p>
</blockquote>
</div>


                </section>
                <section id="run_query">
                            <input id="run_query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">con</span>, </span><span class="param"><span class="n">sql_query</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="run_query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#run_query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="run_query-439"><a href="#run_query-439"><span class="linenos">439</span></a><span class="k">def</span><span class="w"> </span><span class="nf">run_query</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql_query</span><span class="p">):</span>
</span><span id="run_query-440"><a href="#run_query-440"><span class="linenos">440</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="run_query-441"><a href="#run_query-441"><span class="linenos">441</span></a><span class="sd">    Executes the given SQL query on the provided connection object and returns the result.</span>
</span><span id="run_query-442"><a href="#run_query-442"><span class="linenos">442</span></a>
</span><span id="run_query-443"><a href="#run_query-443"><span class="linenos">443</span></a><span class="sd">    Args:</span>
</span><span id="run_query-444"><a href="#run_query-444"><span class="linenos">444</span></a><span class="sd">        con (connection): The connection object to the database.</span>
</span><span id="run_query-445"><a href="#run_query-445"><span class="linenos">445</span></a><span class="sd">        sql_query (str): The SQL query to be executed.</span>
</span><span id="run_query-446"><a href="#run_query-446"><span class="linenos">446</span></a>
</span><span id="run_query-447"><a href="#run_query-447"><span class="linenos">447</span></a><span class="sd">    Returns:</span>
</span><span id="run_query-448"><a href="#run_query-448"><span class="linenos">448</span></a><span class="sd">        result(pd.DataFrame): The result of the SQL query as a DataFrame.</span>
</span><span id="run_query-449"><a href="#run_query-449"><span class="linenos">449</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="run_query-450"><a href="#run_query-450"><span class="linenos">450</span></a>    <span class="c1"># Execute SQL query</span>
</span><span id="run_query-451"><a href="#run_query-451"><span class="linenos">451</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="run_query-452"><a href="#run_query-452"><span class="linenos">452</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Executes the given SQL query on the provided connection object and returns the result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>con (connection):</strong>  The connection object to the database.</li>
<li><strong>sql_query (str):</strong>  The SQL query to be executed.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>result(pd.DataFrame): The result of the SQL query as a DataFrame.</p>
</blockquote>
</div>


                </section>
                <section id="query_result">
                            <input id="query_result-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query_result</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="query_result-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#query_result"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="query_result-455"><a href="#query_result-455"><span class="linenos">455</span></a><span class="k">def</span><span class="w"> </span><span class="nf">query_result</span><span class="p">():</span>
</span><span id="query_result-456"><a href="#query_result-456"><span class="linenos">456</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="query_result-457"><a href="#query_result-457"><span class="linenos">457</span></a><span class="sd">    Displays the query result and allows for editing and exporting of data.</span>
</span><span id="query_result-458"><a href="#query_result-458"><span class="linenos">458</span></a>
</span><span id="query_result-459"><a href="#query_result-459"><span class="linenos">459</span></a><span class="sd">    Returns:</span>
</span><span id="query_result-460"><a href="#query_result-460"><span class="linenos">460</span></a><span class="sd">        st.session_state.query_result, st.session_state.export_df(Tuple): A tuple containing the query result dataframe and the export dataframe.</span>
</span><span id="query_result-461"><a href="#query_result-461"><span class="linenos">461</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="query_result-462"><a href="#query_result-462"><span class="linenos">462</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Query Result&quot;</span><span class="p">)</span>
</span><span id="query_result-463"><a href="#query_result-463"><span class="linenos">463</span></a>    <span class="c1"># Add a toggle for edit mode</span>
</span><span id="query_result-464"><a href="#query_result-464"><span class="linenos">464</span></a>    <span class="n">edit_mode</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">toggle</span><span class="p">(</span><span class="s2">&quot;Edit Mode&quot;</span><span class="p">)</span>
</span><span id="query_result-465"><a href="#query_result-465"><span class="linenos">465</span></a>    <span class="c1"># Manage the edit mode</span>
</span><span id="query_result-466"><a href="#query_result-466"><span class="linenos">466</span></a>    <span class="k">if</span> <span class="n">edit_mode</span><span class="p">:</span>
</span><span id="query_result-467"><a href="#query_result-467"><span class="linenos">467</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">data_editor</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">)</span>
</span><span id="query_result-468"><a href="#query_result-468"><span class="linenos">468</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="query_result-469"><a href="#query_result-469"><span class="linenos">469</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="query_result-470"><a href="#query_result-470"><span class="linenos">470</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="query_result-471"><a href="#query_result-471"><span class="linenos">471</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">)</span>
</span><span id="query_result-472"><a href="#query_result-472"><span class="linenos">472</span></a>
</span><span id="query_result-473"><a href="#query_result-473"><span class="linenos">473</span></a>    <span class="c1"># Prepare dataframe for export data</span>
</span><span id="query_result-474"><a href="#query_result-474"><span class="linenos">474</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="query_result-475"><a href="#query_result-475"><span class="linenos">475</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="query_result-476"><a href="#query_result-476"><span class="linenos">476</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="query_result-477"><a href="#query_result-477"><span class="linenos">477</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="query_result-478"><a href="#query_result-478"><span class="linenos">478</span></a>
</span><span id="query_result-479"><a href="#query_result-479"><span class="linenos">479</span></a>    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span>
</span></pre></div>


            <div class="docstring"><p>Displays the query result and allows for editing and exporting of data.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>st.session_state.query_result, st.session_state.export_df(Tuple): A tuple containing the query result dataframe and the export dataframe.</p>
</blockquote>
</div>


                </section>
                <section id="data_download">
                            <input id="data_download-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">data_download</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_ext</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="data_download-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#data_download"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="data_download-482"><a href="#data_download-482"><span class="linenos">482</span></a><span class="k">def</span><span class="w"> </span><span class="nf">data_download</span><span class="p">(</span><span class="n">file_ext</span><span class="p">):</span>
</span><span id="data_download-483"><a href="#data_download-483"><span class="linenos">483</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="data_download-484"><a href="#data_download-484"><span class="linenos">484</span></a><span class="sd">    Function to download data in different file formats.</span>
</span><span id="data_download-485"><a href="#data_download-485"><span class="linenos">485</span></a>
</span><span id="data_download-486"><a href="#data_download-486"><span class="linenos">486</span></a><span class="sd">    Parameters:</span>
</span><span id="data_download-487"><a href="#data_download-487"><span class="linenos">487</span></a><span class="sd">        file_ext (List[str]): List of file extensions available for download.</span>
</span><span id="data_download-488"><a href="#data_download-488"><span class="linenos">488</span></a>
</span><span id="data_download-489"><a href="#data_download-489"><span class="linenos">489</span></a><span class="sd">    Returns:</span>
</span><span id="data_download-490"><a href="#data_download-490"><span class="linenos">490</span></a><span class="sd">        st.download_button: Download button component that allows the user to download the selected file format.</span>
</span><span id="data_download-491"><a href="#data_download-491"><span class="linenos">491</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="data_download-492"><a href="#data_download-492"><span class="linenos">492</span></a>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="data_download-493"><a href="#data_download-493"><span class="linenos">493</span></a>    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="data_download-494"><a href="#data_download-494"><span class="linenos">494</span></a>        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">popover</span><span class="p">(</span><span class="s2">&quot;Data Download&quot;</span><span class="p">):</span>
</span><span id="data_download-495"><a href="#data_download-495"><span class="linenos">495</span></a>            <span class="c1"># File format selection</span>
</span><span id="data_download-496"><a href="#data_download-496"><span class="linenos">496</span></a>            <span class="n">file_formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">file_ext</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s1">&#39;zip&#39;</span><span class="p">]</span>
</span><span id="data_download-497"><a href="#data_download-497"><span class="linenos">497</span></a>            <span class="n">selected_format</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Select file format:&quot;</span><span class="p">,</span> <span class="n">file_formats</span><span class="p">)</span>
</span><span id="data_download-498"><a href="#data_download-498"><span class="linenos">498</span></a>
</span><span id="data_download-499"><a href="#data_download-499"><span class="linenos">499</span></a>            <span class="c1"># Delimiter and quoting options (for CSV)</span>
</span><span id="data_download-500"><a href="#data_download-500"><span class="linenos">500</span></a>            <span class="k">if</span> <span class="n">selected_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="data_download-501"><a href="#data_download-501"><span class="linenos">501</span></a>                <span class="n">header</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Header:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
</span><span id="data_download-502"><a href="#data_download-502"><span class="linenos">502</span></a>                <span class="n">delimiter</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span><span class="s2">&quot;Delimiter:&quot;</span><span class="p">,</span> <span class="n">max_chars</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
</span><span id="data_download-503"><a href="#data_download-503"><span class="linenos">503</span></a>                <span class="n">quoting_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="data_download-504"><a href="#data_download-504"><span class="linenos">504</span></a>                    <span class="s1">&#39;QUOTE_ALL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_ALL</span><span class="p">,</span>
</span><span id="data_download-505"><a href="#data_download-505"><span class="linenos">505</span></a>                    <span class="s1">&#39;QUOTE_MINIMAL&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">,</span>
</span><span id="data_download-506"><a href="#data_download-506"><span class="linenos">506</span></a>                    <span class="s1">&#39;QUOTE_NONNUMERIC&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONNUMERIC</span><span class="p">,</span>
</span><span id="data_download-507"><a href="#data_download-507"><span class="linenos">507</span></a>                    <span class="s1">&#39;QUOTE_NONE&#39;</span><span class="p">:</span> <span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span>
</span><span id="data_download-508"><a href="#data_download-508"><span class="linenos">508</span></a>                <span class="p">}</span>
</span><span id="data_download-509"><a href="#data_download-509"><span class="linenos">509</span></a>                <span class="n">quoting</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Quoting:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">quoting_options</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="data_download-510"><a href="#data_download-510"><span class="linenos">510</span></a>                <span class="n">head</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="data_download-511"><a href="#data_download-511"><span class="linenos">511</span></a>
</span><span id="data_download-512"><a href="#data_download-512"><span class="linenos">512</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span>
</span><span id="data_download-513"><a href="#data_download-513"><span class="linenos">513</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">,</span>
</span><span id="data_download-514"><a href="#data_download-514"><span class="linenos">514</span></a>                    <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">quoting_options</span><span class="p">[</span><span class="n">quoting</span><span class="p">],</span> <span class="n">header</span><span class="o">=</span><span class="n">head</span>
</span><span id="data_download-515"><a href="#data_download-515"><span class="linenos">515</span></a>                <span class="p">)</span>
</span><span id="data_download-516"><a href="#data_download-516"><span class="linenos">516</span></a>            <span class="c1"># Manage XLSX download</span>
</span><span id="data_download-517"><a href="#data_download-517"><span class="linenos">517</span></a>            <span class="k">elif</span> <span class="n">selected_format</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="data_download-518"><a href="#data_download-518"><span class="linenos">518</span></a>                <span class="n">header</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Header:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>
</span><span id="data_download-519"><a href="#data_download-519"><span class="linenos">519</span></a>                <span class="n">head</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Y&#39;</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="data_download-520"><a href="#data_download-520"><span class="linenos">520</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">head</span><span class="p">)</span>
</span><span id="data_download-521"><a href="#data_download-521"><span class="linenos">521</span></a>            <span class="c1"># Manage other file download</span>
</span><span id="data_download-522"><a href="#data_download-522"><span class="linenos">522</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="data_download-523"><a href="#data_download-523"><span class="linenos">523</span></a>                <span class="n">file_content</span> <span class="o">=</span> <span class="n">df_to_file</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span><span class="p">,</span> <span class="n">selected_format</span><span class="p">)</span>
</span><span id="data_download-524"><a href="#data_download-524"><span class="linenos">524</span></a>
</span><span id="data_download-525"><a href="#data_download-525"><span class="linenos">525</span></a>            <span class="c1"># Generate file name and MIME type</span>
</span><span id="data_download-526"><a href="#data_download-526"><span class="linenos">526</span></a>            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;query_result.</span><span class="si">{</span><span class="n">selected_format</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="data_download-527"><a href="#data_download-527"><span class="linenos">527</span></a>            <span class="n">mime_types</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="data_download-528"><a href="#data_download-528"><span class="linenos">528</span></a>                <span class="s1">&#39;csv&#39;</span><span class="p">:</span> <span class="s1">&#39;text/csv&#39;</span><span class="p">,</span>
</span><span id="data_download-529"><a href="#data_download-529"><span class="linenos">529</span></a>                <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span> <span class="s1">&#39;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#39;</span><span class="p">,</span>
</span><span id="data_download-530"><a href="#data_download-530"><span class="linenos">530</span></a>                <span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="data_download-531"><a href="#data_download-531"><span class="linenos">531</span></a>                <span class="s1">&#39;parquet&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">,</span>
</span><span id="data_download-532"><a href="#data_download-532"><span class="linenos">532</span></a>                <span class="s1">&#39;xml&#39;</span><span class="p">:</span> <span class="s1">&#39;application/xml&#39;</span>
</span><span id="data_download-533"><a href="#data_download-533"><span class="linenos">533</span></a>            <span class="p">}</span>
</span><span id="data_download-534"><a href="#data_download-534"><span class="linenos">534</span></a>            <span class="n">mime_type</span> <span class="o">=</span> <span class="n">mime_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selected_format</span><span class="p">,</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</span><span id="data_download-535"><a href="#data_download-535"><span class="linenos">535</span></a>
</span><span id="data_download-536"><a href="#data_download-536"><span class="linenos">536</span></a>            <span class="c1"># Download button</span>
</span><span id="data_download-537"><a href="#data_download-537"><span class="linenos">537</span></a>            <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span>
</span><span id="data_download-538"><a href="#data_download-538"><span class="linenos">538</span></a>                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Download&quot;</span><span class="p">,</span>
</span><span id="data_download-539"><a href="#data_download-539"><span class="linenos">539</span></a>                <span class="n">data</span><span class="o">=</span><span class="n">file_content</span><span class="p">,</span>
</span><span id="data_download-540"><a href="#data_download-540"><span class="linenos">540</span></a>                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
</span><span id="data_download-541"><a href="#data_download-541"><span class="linenos">541</span></a>                <span class="n">mime</span><span class="o">=</span><span class="n">mime_type</span><span class="p">,</span>
</span><span id="data_download-542"><a href="#data_download-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Function to download data in different file formats.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>file_ext (List[str]):</strong>  List of file extensions available for download.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>st.download_button: Download button component that allows the user to download the selected file format.</p>
</blockquote>
</div>


                </section>
                <section id="df_to_file">
                            <input id="df_to_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">df_to_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">df</span>, </span><span class="param"><span class="n">file_format</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="df_to_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#df_to_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="df_to_file-545"><a href="#df_to_file-545"><span class="linenos">545</span></a><span class="k">def</span><span class="w"> </span><span class="nf">df_to_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">file_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="df_to_file-546"><a href="#df_to_file-546"><span class="linenos">546</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="df_to_file-547"><a href="#df_to_file-547"><span class="linenos">547</span></a><span class="sd">    Convert DataFrame to various file formats.</span>
</span><span id="df_to_file-548"><a href="#df_to_file-548"><span class="linenos">548</span></a>
</span><span id="df_to_file-549"><a href="#df_to_file-549"><span class="linenos">549</span></a><span class="sd">    Args:</span>
</span><span id="df_to_file-550"><a href="#df_to_file-550"><span class="linenos">550</span></a><span class="sd">        df (pd.DataFrame): The DataFrame to convert.</span>
</span><span id="df_to_file-551"><a href="#df_to_file-551"><span class="linenos">551</span></a><span class="sd">        file_format (str): The desired file format.</span>
</span><span id="df_to_file-552"><a href="#df_to_file-552"><span class="linenos">552</span></a><span class="sd">        **kwargs: Additional arguments for specific file formats.</span>
</span><span id="df_to_file-553"><a href="#df_to_file-553"><span class="linenos">553</span></a>
</span><span id="df_to_file-554"><a href="#df_to_file-554"><span class="linenos">554</span></a><span class="sd">    Returns:</span>
</span><span id="df_to_file-555"><a href="#df_to_file-555"><span class="linenos">555</span></a><span class="sd">        bytes: The DataFrame converted to the specified format.</span>
</span><span id="df_to_file-556"><a href="#df_to_file-556"><span class="linenos">556</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="df_to_file-557"><a href="#df_to_file-557"><span class="linenos">557</span></a>    <span class="c1"># Create the buffer</span>
</span><span id="df_to_file-558"><a href="#df_to_file-558"><span class="linenos">558</span></a>    <span class="n">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="df_to_file-559"><a href="#df_to_file-559"><span class="linenos">559</span></a>
</span><span id="df_to_file-560"><a href="#df_to_file-560"><span class="linenos">560</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="df_to_file-561"><a href="#df_to_file-561"><span class="linenos">561</span></a>        <span class="c1"># Manage CSV and TXT files</span>
</span><span id="df_to_file-562"><a href="#df_to_file-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="n">file_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">]:</span>
</span><span id="df_to_file-563"><a href="#df_to_file-563"><span class="linenos">563</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span>
</span><span id="df_to_file-564"><a href="#df_to_file-564"><span class="linenos">564</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="df_to_file-565"><a href="#df_to_file-565"><span class="linenos">565</span></a>                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="df_to_file-566"><a href="#df_to_file-566"><span class="linenos">566</span></a>            <span class="c1"># Catch specific CSV writing errors</span>
</span><span id="df_to_file-567"><a href="#df_to_file-567"><span class="linenos">567</span></a>            <span class="k">except</span> <span class="n">csv</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="df_to_file-568"><a href="#df_to_file-568"><span class="linenos">568</span></a>                <span class="k">if</span> <span class="s2">&quot;need to escape&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="df_to_file-569"><a href="#df_to_file-569"><span class="linenos">569</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Special character found in the data.  </span><span class="se">\n</span><span class="s2">Please select a different quoting option.&quot;</span><span class="p">)</span>
</span><span id="df_to_file-570"><a href="#df_to_file-570"><span class="linenos">570</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="df_to_file-571"><a href="#df_to_file-571"><span class="linenos">571</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> writing error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="df_to_file-572"><a href="#df_to_file-572"><span class="linenos">572</span></a>        <span class="c1"># Manage XLSX files</span>
</span><span id="df_to_file-573"><a href="#df_to_file-573"><span class="linenos">573</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">:</span>
</span><span id="df_to_file-574"><a href="#df_to_file-574"><span class="linenos">574</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="df_to_file-575"><a href="#df_to_file-575"><span class="linenos">575</span></a>        <span class="c1"># Manage JSON files</span>
</span><span id="df_to_file-576"><a href="#df_to_file-576"><span class="linenos">576</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span><span id="df_to_file-577"><a href="#df_to_file-577"><span class="linenos">577</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="df_to_file-578"><a href="#df_to_file-578"><span class="linenos">578</span></a>        <span class="c1"># Manage Parquet files</span>
</span><span id="df_to_file-579"><a href="#df_to_file-579"><span class="linenos">579</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;parquet&#39;</span><span class="p">:</span>
</span><span id="df_to_file-580"><a href="#df_to_file-580"><span class="linenos">580</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pyarrow&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="df_to_file-581"><a href="#df_to_file-581"><span class="linenos">581</span></a>        <span class="c1"># Manage XML files</span>
</span><span id="df_to_file-582"><a href="#df_to_file-582"><span class="linenos">582</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
</span><span id="df_to_file-583"><a href="#df_to_file-583"><span class="linenos">583</span></a>            <span class="n">df</span><span class="o">.</span><span class="n">to_xml</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="df_to_file-584"><a href="#df_to_file-584"><span class="linenos">584</span></a>        <span class="c1"># Manage Avro files</span>
</span><span id="df_to_file-585"><a href="#df_to_file-585"><span class="linenos">585</span></a>        <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s1">&#39;avro&#39;</span><span class="p">:</span>
</span><span id="df_to_file-586"><a href="#df_to_file-586"><span class="linenos">586</span></a>            <span class="n">pdx</span><span class="o">.</span><span class="n">to_avro</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</span><span id="df_to_file-587"><a href="#df_to_file-587"><span class="linenos">587</span></a>        <span class="c1"># Get unsupported files error</span>
</span><span id="df_to_file-588"><a href="#df_to_file-588"><span class="linenos">588</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="df_to_file-589"><a href="#df_to_file-589"><span class="linenos">589</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="df_to_file-590"><a href="#df_to_file-590"><span class="linenos">590</span></a>    <span class="c1"># Catch errors for df to file conversion</span>
</span><span id="df_to_file-591"><a href="#df_to_file-591"><span class="linenos">591</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="df_to_file-592"><a href="#df_to_file-592"><span class="linenos">592</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="df_to_file-593"><a href="#df_to_file-593"><span class="linenos">593</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> export not available for your data.  </span><span class="se">\n</span><span class="s2">Please select a different format.&quot;</span><span class="p">)</span>
</span><span id="df_to_file-594"><a href="#df_to_file-594"><span class="linenos">594</span></a>
</span><span id="df_to_file-595"><a href="#df_to_file-595"><span class="linenos">595</span></a>    <span class="c1"># Return the buffer</span>
</span><span id="df_to_file-596"><a href="#df_to_file-596"><span class="linenos">596</span></a>    <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="df_to_file-597"><a href="#df_to_file-597"><span class="linenos">597</span></a>    <span class="k">return</span> <span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Convert DataFrame to various file formats.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>df (pd.DataFrame):</strong>  The DataFrame to convert.</li>
<li><strong>file_format (str):</strong>  The desired file format.</li>
<li><strong>**kwargs:</strong>  Additional arguments for specific file formats.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bytes: The DataFrame converted to the specified format.</p>
</blockquote>
</div>


                </section>
                <section id="sql_completions">
                            <input id="sql_completions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sql_completions</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sql_completions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sql_completions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sql_completions-600"><a href="#sql_completions-600"><span class="linenos">600</span></a><span class="k">def</span><span class="w"> </span><span class="nf">sql_completions</span><span class="p">():</span>
</span><span id="sql_completions-601"><a href="#sql_completions-601"><span class="linenos">601</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="sql_completions-602"><a href="#sql_completions-602"><span class="linenos">602</span></a><span class="sd">    Function to generate SQL completions for the code editor.</span>
</span><span id="sql_completions-603"><a href="#sql_completions-603"><span class="linenos">603</span></a>
</span><span id="sql_completions-604"><a href="#sql_completions-604"><span class="linenos">604</span></a><span class="sd">    Returns:</span>
</span><span id="sql_completions-605"><a href="#sql_completions-605"><span class="linenos">605</span></a><span class="sd">        None</span>
</span><span id="sql_completions-606"><a href="#sql_completions-606"><span class="linenos">606</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="sql_completions-607"><a href="#sql_completions-607"><span class="linenos">607</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="sql_completions-608"><a href="#sql_completions-608"><span class="linenos">608</span></a>        <span class="c1"># Get connection</span>
</span><span id="sql_completions-609"><a href="#sql_completions-609"><span class="linenos">609</span></a>        <span class="n">con</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span>
</span><span id="sql_completions-610"><a href="#sql_completions-610"><span class="linenos">610</span></a>        <span class="c1"># Get loaded tables list</span>
</span><span id="sql_completions-611"><a href="#sql_completions-611"><span class="linenos">611</span></a>        <span class="n">tab_list</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span>
</span><span id="sql_completions-612"><a href="#sql_completions-612"><span class="linenos">612</span></a>        <span class="c1"># Reset completions list</span>
</span><span id="sql_completions-613"><a href="#sql_completions-613"><span class="linenos">613</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="sql_completions-614"><a href="#sql_completions-614"><span class="linenos">614</span></a>
</span><span id="sql_completions-615"><a href="#sql_completions-615"><span class="linenos">615</span></a>        <span class="c1"># Loop all tables and get columns names</span>
</span><span id="sql_completions-616"><a href="#sql_completions-616"><span class="linenos">616</span></a>        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tab_list</span><span class="p">:</span>
</span><span id="sql_completions-617"><a href="#sql_completions-617"><span class="linenos">617</span></a>            <span class="c1"># Ensure table_name is a non-empty string before proceeding</span>
</span><span id="sql_completions-618"><a href="#sql_completions-618"><span class="linenos">618</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">table_name</span><span class="p">:</span>
</span><span id="sql_completions-619"><a href="#sql_completions-619"><span class="linenos">619</span></a>                <span class="c1"># Add table name completion</span>
</span><span id="sql_completions-620"><a href="#sql_completions-620"><span class="linenos">620</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="sql_completions-621"><a href="#sql_completions-621"><span class="linenos">621</span></a>                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span>
</span><span id="sql_completions-622"><a href="#sql_completions-622"><span class="linenos">622</span></a>                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>  <span class="c1"># Add quotes for safety</span>
</span><span id="sql_completions-623"><a href="#sql_completions-623"><span class="linenos">623</span></a>                    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="s2">&quot;table&quot;</span><span class="p">,</span>
</span><span id="sql_completions-624"><a href="#sql_completions-624"><span class="linenos">624</span></a>                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;table_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Added unique name</span>
</span><span id="sql_completions-625"><a href="#sql_completions-625"><span class="linenos">625</span></a>                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mi">200</span>
</span><span id="sql_completions-626"><a href="#sql_completions-626"><span class="linenos">626</span></a>                <span class="p">})</span>
</span><span id="sql_completions-627"><a href="#sql_completions-627"><span class="linenos">627</span></a>
</span><span id="sql_completions-628"><a href="#sql_completions-628"><span class="linenos">628</span></a>                <span class="c1"># Get column names for the table</span>
</span><span id="sql_completions-629"><a href="#sql_completions-629"><span class="linenos">629</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="sql_completions-630"><a href="#sql_completions-630"><span class="linenos">630</span></a>                    <span class="c1"># Use PRAGMA table_info to fetch column metadata</span>
</span><span id="sql_completions-631"><a href="#sql_completions-631"><span class="linenos">631</span></a>                    <span class="n">columns_df</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PRAGMA table_info(&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&quot;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchdf</span><span class="p">()</span>
</span><span id="sql_completions-632"><a href="#sql_completions-632"><span class="linenos">632</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">columns_df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">columns_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="sql_completions-633"><a href="#sql_completions-633"><span class="linenos">633</span></a>                        <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">columns_df</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
</span><span id="sql_completions-634"><a href="#sql_completions-634"><span class="linenos">634</span></a>                            <span class="c1"># Ensure column_name is a non-empty string</span>
</span><span id="sql_completions-635"><a href="#sql_completions-635"><span class="linenos">635</span></a>                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">column_name</span><span class="p">:</span>
</span><span id="sql_completions-636"><a href="#sql_completions-636"><span class="linenos">636</span></a>                                <span class="c1"># Add column name completion</span>
</span><span id="sql_completions-637"><a href="#sql_completions-637"><span class="linenos">637</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="sql_completions-638"><a href="#sql_completions-638"><span class="linenos">638</span></a>                                    <span class="s2">&quot;caption&quot;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">,</span>
</span><span id="sql_completions-639"><a href="#sql_completions-639"><span class="linenos">639</span></a>                                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">,</span>  <span class="c1"># Add quotes for safety</span>
</span><span id="sql_completions-640"><a href="#sql_completions-640"><span class="linenos">640</span></a>                                    <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="s2">&quot;column&quot;</span><span class="p">,</span>
</span><span id="sql_completions-641"><a href="#sql_completions-641"><span class="linenos">641</span></a>                                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;col_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Added unique name</span>
</span><span id="sql_completions-642"><a href="#sql_completions-642"><span class="linenos">642</span></a>                                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mi">100</span>
</span><span id="sql_completions-643"><a href="#sql_completions-643"><span class="linenos">643</span></a>                                <span class="p">})</span>
</span><span id="sql_completions-644"><a href="#sql_completions-644"><span class="linenos">644</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="sql_completions-645"><a href="#sql_completions-645"><span class="linenos">645</span></a>                    <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not fetch columns for table &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="sql_completions-646"><a href="#sql_completions-646"><span class="linenos">646</span></a>                    <span class="k">pass</span>
</span><span id="sql_completions-647"><a href="#sql_completions-647"><span class="linenos">647</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="sql_completions-648"><a href="#sql_completions-648"><span class="linenos">648</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not generate SQL suggestions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="sql_completions-649"><a href="#sql_completions-649"><span class="linenos">649</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Function to generate SQL completions for the code editor.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-652"><a href="#main-652"><span class="linenos">652</span></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="main-653"><a href="#main-653"><span class="linenos">653</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-654"><a href="#main-654"><span class="linenos">654</span></a><span class="sd">    The main function of the DataQuery application.</span>
</span><span id="main-655"><a href="#main-655"><span class="linenos">655</span></a>
</span><span id="main-656"><a href="#main-656"><span class="linenos">656</span></a><span class="sd">    This function handles the main logic of the application, including file uploading, data loading, data preview, SQL query execution, and result visualization.</span>
</span><span id="main-657"><a href="#main-657"><span class="linenos">657</span></a><span class="sd">    It collects files settings for csv, txt and xlsx files.</span>
</span><span id="main-658"><a href="#main-658"><span class="linenos">658</span></a><span class="sd">    It also provides options for editing and downloading query results.</span>
</span><span id="main-659"><a href="#main-659"><span class="linenos">659</span></a>
</span><span id="main-660"><a href="#main-660"><span class="linenos">660</span></a><span class="sd">    Returns:</span>
</span><span id="main-661"><a href="#main-661"><span class="linenos">661</span></a><span class="sd">        None</span>
</span><span id="main-662"><a href="#main-662"><span class="linenos">662</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-663"><a href="#main-663"><span class="linenos">663</span></a>    <span class="c1"># Set page config</span>
</span><span id="main-664"><a href="#main-664"><span class="linenos">664</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">set_page_config</span><span class="p">(</span><span class="n">page_title</span><span class="o">=</span><span class="s1">&#39;DataQuery&#39;</span><span class="p">,</span> <span class="n">page_icon</span><span class="o">=</span><span class="s1">&#39;:o:&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;wide&quot;</span><span class="p">)</span>
</span><span id="main-665"><a href="#main-665"><span class="linenos">665</span></a>    <span class="c1"># Set title and subheader</span>
</span><span id="main-666"><a href="#main-666"><span class="linenos">666</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DataQuery&quot;</span><span class="p">)</span>
</span><span id="main-667"><a href="#main-667"><span class="linenos">667</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;Preview, query, edit and export data files&quot;</span><span class="p">)</span>
</span><span id="main-668"><a href="#main-668"><span class="linenos">668</span></a>
</span><span id="main-669"><a href="#main-669"><span class="linenos">669</span></a>    <span class="c1"># Supported file extensions</span>
</span><span id="main-670"><a href="#main-670"><span class="linenos">670</span></a>    <span class="n">file_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;avro&#39;</span><span class="p">,</span> <span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;parquet&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">]</span>
</span><span id="main-671"><a href="#main-671"><span class="linenos">671</span></a>    <span class="c1"># Number of rows read for preview</span>
</span><span id="main-672"><a href="#main-672"><span class="linenos">672</span></a>    <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="main-673"><a href="#main-673"><span class="linenos">673</span></a>
</span><span id="main-674"><a href="#main-674"><span class="linenos">674</span></a>    <span class="c1"># Initialize session state variables</span>
</span><span id="main-675"><a href="#main-675"><span class="linenos">675</span></a>    <span class="k">if</span> <span class="s1">&#39;query_result&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-676"><a href="#main-676"><span class="linenos">676</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-677"><a href="#main-677"><span class="linenos">677</span></a>    <span class="k">if</span> <span class="s1">&#39;tables&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-678"><a href="#main-678"><span class="linenos">678</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="main-679"><a href="#main-679"><span class="linenos">679</span></a>    <span class="k">if</span> <span class="s1">&#39;con&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-680"><a href="#main-680"><span class="linenos">680</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
</span><span id="main-681"><a href="#main-681"><span class="linenos">681</span></a>    <span class="k">if</span> <span class="s1">&#39;uploaded_files&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-682"><a href="#main-682"><span class="linenos">682</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-683"><a href="#main-683"><span class="linenos">683</span></a>    <span class="k">if</span> <span class="s1">&#39;edited_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-684"><a href="#main-684"><span class="linenos">684</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-685"><a href="#main-685"><span class="linenos">685</span></a>    <span class="k">if</span> <span class="s1">&#39;export_df&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-686"><a href="#main-686"><span class="linenos">686</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-687"><a href="#main-687"><span class="linenos">687</span></a>    <span class="k">if</span> <span class="s1">&#39;completions&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-688"><a href="#main-688"><span class="linenos">688</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-689"><a href="#main-689"><span class="linenos">689</span></a>    <span class="k">if</span> <span class="s1">&#39;query_statement&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="main-690"><a href="#main-690"><span class="linenos">690</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="main-691"><a href="#main-691"><span class="linenos">691</span></a>
</span><span id="main-692"><a href="#main-692"><span class="linenos">692</span></a>    <span class="c1"># Files upload</span>
</span><span id="main-693"><a href="#main-693"><span class="linenos">693</span></a>    <span class="n">upload_files</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="main-694"><a href="#main-694"><span class="linenos">694</span></a>
</span><span id="main-695"><a href="#main-695"><span class="linenos">695</span></a>    <span class="c1"># If files uploaded</span>
</span><span id="main-696"><a href="#main-696"><span class="linenos">696</span></a>    <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span><span class="p">:</span>
</span><span id="main-697"><a href="#main-697"><span class="linenos">697</span></a>        <span class="c1"># Load files to db</span>
</span><span id="main-698"><a href="#main-698"><span class="linenos">698</span></a>        <span class="n">files_to_db</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="main-699"><a href="#main-699"><span class="linenos">699</span></a>
</span><span id="main-700"><a href="#main-700"><span class="linenos">700</span></a>        <span class="c1"># If tables created</span>
</span><span id="main-701"><a href="#main-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="main-702"><a href="#main-702"><span class="linenos">702</span></a>            <span class="c1"># Display data preview for each table</span>
</span><span id="main-703"><a href="#main-703"><span class="linenos">703</span></a>            <span class="n">data_preview</span><span class="p">(</span><span class="n">num_rows</span><span class="o">=</span><span class="n">num_rows</span><span class="p">)</span>
</span><span id="main-704"><a href="#main-704"><span class="linenos">704</span></a>            <span class="c1"># Provide SQL query section</span>
</span><span id="main-705"><a href="#main-705"><span class="linenos">705</span></a>            <span class="n">get_query</span><span class="p">()</span>
</span><span id="main-706"><a href="#main-706"><span class="linenos">706</span></a>
</span><span id="main-707"><a href="#main-707"><span class="linenos">707</span></a>        <span class="c1"># If query result</span>
</span><span id="main-708"><a href="#main-708"><span class="linenos">708</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="main-709"><a href="#main-709"><span class="linenos">709</span></a>            <span class="c1"># Display query result</span>
</span><span id="main-710"><a href="#main-710"><span class="linenos">710</span></a>            <span class="n">query_result</span><span class="p">()</span>
</span><span id="main-711"><a href="#main-711"><span class="linenos">711</span></a>
</span><span id="main-712"><a href="#main-712"><span class="linenos">712</span></a>            <span class="c1"># Display data download section</span>
</span><span id="main-713"><a href="#main-713"><span class="linenos">713</span></a>            <span class="n">data_download</span><span class="p">(</span><span class="n">file_ext</span><span class="p">)</span>
</span><span id="main-714"><a href="#main-714"><span class="linenos">714</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="main-715"><a href="#main-715"><span class="linenos">715</span></a>        <span class="c1"># Reset session state variables</span>
</span><span id="main-716"><a href="#main-716"><span class="linenos">716</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="main-717"><a href="#main-717"><span class="linenos">717</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-718"><a href="#main-718"><span class="linenos">718</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">export_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-719"><a href="#main-719"><span class="linenos">719</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">uploaded_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-720"><a href="#main-720"><span class="linenos">720</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">edited_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="main-721"><a href="#main-721"><span class="linenos">721</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">completions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-722"><a href="#main-722"><span class="linenos">722</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">query_statement</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></pre></div>


            <div class="docstring"><p>The main function of the DataQuery application.</p>

<p>This function handles the main logic of the application, including file uploading, data loading, data preview, SQL query execution, and result visualization.
It collects files settings for csv, txt and xlsx files.
It also provides options for editing and downloading query results.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None</p>
</blockquote>
</div>


                </section>
    </main>
</body>
</html>